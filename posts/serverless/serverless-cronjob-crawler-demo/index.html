<!doctype html>
<html lang="ko"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>서버리스로 CronJob 만들기 (코로나 크롤러) - Changhoi Kim</title><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="white"><meta name="application-name" content="Changhoi Kim"><meta name="msapplication-TileImage" content="/img/favicon.ico"><meta name="msapplication-TileColor" content="white"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Changhoi Kim"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="현재 진행하고 있는 프로젝트에서는 크로나 현황을 간단하게 보여주는 섹션이 존재하는데, 이 부분을 누군가가 (API 형식으로다가?) 제공해주고 있는 것으로 알고 있었다. 그렇지만 아직 나온 건 없었고, 어쩔 수 없이 간단한 크롤러를 만들고 업데이트 해주기로 했다. 현재 프로젝트가 서버리스로 돌고 있기도 하고, Scheduled 된 작업을 돌리기 위해서는 람다"><meta property="og:type" content="blog"><meta property="og:title" content="서버리스로 CronJob 만들기 (코로나 크롤러)"><meta property="og:url" content="https://changhoi.kim/posts/serverless/serverless-cronjob-crawler-demo/"><meta property="og:site_name" content="Changhoi Kim"><meta property="og:description" content="현재 진행하고 있는 프로젝트에서는 크로나 현황을 간단하게 보여주는 섹션이 존재하는데, 이 부분을 누군가가 (API 형식으로다가?) 제공해주고 있는 것으로 알고 있었다. 그렇지만 아직 나온 건 없었고, 어쩔 수 없이 간단한 크롤러를 만들고 업데이트 해주기로 했다. 현재 프로젝트가 서버리스로 돌고 있기도 하고, Scheduled 된 작업을 돌리기 위해서는 람다"><meta property="og:locale" content="ko_KR"><meta property="og:image" content="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOEAAADhCAMAAAAJbSJIAAAAolBMVEUAAAD+V1H/WVP/WlRoJiSmPzwGAADRVVL3X1lmLizcU1D/WFCaPjsAAQDPTUsAAAPCS0f/Xlf/XFo/Hx5hLCtpLC1UKSf/W1LVUEz/VlbPTkd0MTDGS0a9S0h7NS8jCwqONzXsXFUnFBJSIyGjQj6YPzxJHhs2GRg/GxqGODdeJSQeCwrsWVanREBBFhVJIBzcXVW9SkUXCwt9OTi4VVWpSkrtSDTvAAADZ0lEQVR4nO3bW1vaMBzH8TSdnGKNrTJlypSJYzo8b+//rS14ASQUmpaLJuz7uVL857G/J+kpIUIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA0cdavcm7VZ6bFsLKNKfnaUqAN03S3UXoq9Fq9Ft0LKSsapabisrVIjuNkN5UOTb+ty82HFY1MxehbS4E2HMuKY+05Da6KynhJIpU6aSVOiaqE8tppMPYIaDo5noTpd6dB79AS5jd2fT89tITWgZpLzlvVeRtbQnlrVWsx8QkYUUKV/7DuhuIur75TxJNQmT8NRKY7y+JMTL0GaSwJzV1tdO+UT5LDOg9V8dOufs69unDRNIqEqZw41ffS44ntM6AMJ+Guw1RPTvVASc8rTRLOc2m+9QWhSIs7u3iWmw995EUeTB/++rLD0Cme7Sp23JX+OwAAgIhkwn5xDlBWXRK/0DuhfaEMg/7RFufWIWZiuq1wi4fWIjmOU1mqeLTrbvKkvLCUkhfBvB9um8WYCL3qQ/PTrddc9+odP/x5mrHorFVpcVInYAwJ0759pfjtPckWS8JeZz2hFle1BmnwCc1Hp9bVviOu/SYRY0loBumVU+a1ahhNQqk2lraHqd96RSQJ1WLVMLMe2ryWtuNJmKTprVM1r3cahp5QjvKZXfSYey5XRJJQJQOn6Eke1nkolbtqOK/ZhWElLDm8/NmueSl8vgZluQhnde2+t6F4ra6p1m0lTpnOJut5JsvE4pOyut1aS+RldTPMms0qhT0FojdnIGrPSGShzGEAAIAy2rpV7/FoEs4tX6+zI2XmV91IW2G8rB1dpvfpiFBiPgxs1vyFFmeDpsZtJXI57/ju/IXnt55dUslw9j1ZEeTUuUS8NgoY1iyGlTB/sSdKZz6bnKJKOLf+pmuuGkaQUC4uD6tRqsVls4BhJlzsrkit/aKZuClqTrGFnXC0uSDz0exKGmjCRS++mYG5PkhPGwYMNWGSO6uG7zVXDQNPaM643rt9r6i5tB16wsTZa2ieScdNT8MwE0prQ+xnV84Tv31ckSRM1PqG2MWL02Mq1SElVIn7rHzUeJAGlfCju/ThvNL96e7jb0uB/O29dhTKG/CSs5aSZXtF1AHN0yw5S04BHiEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPg//AO9zTv9FO6XegAAAABJRU5ErkJggg=="><meta property="article:published_time" content="2020-02-29T15:00:00.000Z"><meta property="article:modified_time" content="2020-02-29T15:00:00.000Z"><meta property="article:author" content="changhoi"><meta property="article:tag" content="lambda"><meta property="article:tag" content="serverless"><meta property="article:tag" content="dynamodb"><meta property="article:tag" content="aws"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOEAAADhCAMAAAAJbSJIAAAAolBMVEUAAAD+V1H/WVP/WlRoJiSmPzwGAADRVVL3X1lmLizcU1D/WFCaPjsAAQDPTUsAAAPCS0f/Xlf/XFo/Hx5hLCtpLC1UKSf/W1LVUEz/VlbPTkd0MTDGS0a9S0h7NS8jCwqONzXsXFUnFBJSIyGjQj6YPzxJHhs2GRg/GxqGODdeJSQeCwrsWVanREBBFhVJIBzcXVW9SkUXCwt9OTi4VVWpSkrtSDTvAAADZ0lEQVR4nO3bW1vaMBzH8TSdnGKNrTJlypSJYzo8b+//rS14ASQUmpaLJuz7uVL857G/J+kpIUIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA0cdavcm7VZ6bFsLKNKfnaUqAN03S3UXoq9Fq9Ft0LKSsapabisrVIjuNkN5UOTb+ty82HFY1MxehbS4E2HMuKY+05Da6KynhJIpU6aSVOiaqE8tppMPYIaDo5noTpd6dB79AS5jd2fT89tITWgZpLzlvVeRtbQnlrVWsx8QkYUUKV/7DuhuIur75TxJNQmT8NRKY7y+JMTL0GaSwJzV1tdO+UT5LDOg9V8dOufs69unDRNIqEqZw41ffS44ntM6AMJ+Guw1RPTvVASc8rTRLOc2m+9QWhSIs7u3iWmw995EUeTB/++rLD0Cme7Sp23JX+OwAAgIhkwn5xDlBWXRK/0DuhfaEMg/7RFufWIWZiuq1wi4fWIjmOU1mqeLTrbvKkvLCUkhfBvB9um8WYCL3qQ/PTrddc9+odP/x5mrHorFVpcVInYAwJ0759pfjtPckWS8JeZz2hFle1BmnwCc1Hp9bVviOu/SYRY0loBumVU+a1ahhNQqk2lraHqd96RSQJ1WLVMLMe2ryWtuNJmKTprVM1r3cahp5QjvKZXfSYey5XRJJQJQOn6Eke1nkolbtqOK/ZhWElLDm8/NmueSl8vgZluQhnde2+t6F4ra6p1m0lTpnOJut5JsvE4pOyut1aS+RldTPMms0qhT0FojdnIGrPSGShzGEAAIAy2rpV7/FoEs4tX6+zI2XmV91IW2G8rB1dpvfpiFBiPgxs1vyFFmeDpsZtJXI57/ju/IXnt55dUslw9j1ZEeTUuUS8NgoY1iyGlTB/sSdKZz6bnKJKOLf+pmuuGkaQUC4uD6tRqsVls4BhJlzsrkit/aKZuClqTrGFnXC0uSDz0exKGmjCRS++mYG5PkhPGwYMNWGSO6uG7zVXDQNPaM643rt9r6i5tB16wsTZa2ieScdNT8MwE0prQ+xnV84Tv31ckSRM1PqG2MWL02Mq1SElVIn7rHzUeJAGlfCju/ThvNL96e7jb0uB/O29dhTKG/CSs5aSZXtF1AHN0yw5S04BHiEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPg//AO9zTv9FO6XegAAAABJRU5ErkJggg=="><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://changhoi.kim/posts/serverless/serverless-cronjob-crawler-demo/"},"headline":"서버리스로 CronJob 만들기 (코로나 크롤러)","image":[],"datePublished":"2020-02-29T15:00:00.000Z","dateModified":"2020-02-29T15:00:00.000Z","author":{"@type":"Person","name":"changhoi"},"publisher":{"@type":"Organization","name":"Changhoi Kim","logo":{"@type":"ImageObject","url":"https://changhoi.kim/img/logo.jpg"}},"description":"현재 진행하고 있는 프로젝트에서는 크로나 현황을 간단하게 보여주는 섹션이 존재하는데, 이 부분을 누군가가 (API 형식으로다가?) 제공해주고 있는 것으로 알고 있었다. 그렇지만 아직 나온 건 없었고, 어쩔 수 없이 간단한 크롤러를 만들고 업데이트 해주기로 했다. 현재 프로젝트가 서버리스로 돌고 있기도 하고, Scheduled 된 작업을 돌리기 위해서는 람다"}</script><link rel="canonical" href="https://changhoi.kim/posts/serverless/serverless-cronjob-crawler-demo/"><link rel="alternate" href="/rss2.xml" title="Changhoi Kim" type="application/atom+xml"><link rel="icon" href="/img/favicon.ico"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link data-pjax rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link data-pjax rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=G-QBSLW6WTZW" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'G-QBSLW6WTZW');</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css"><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.jpg" alt="Changhoi Kim" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item is-hidden-tablet catalogue" title="카탈로그" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="검색" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><div class="card-image"><span class="image is-7by3"><img class="fill" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOEAAADhCAMAAAAJbSJIAAAAolBMVEUAAAD+V1H/WVP/WlRoJiSmPzwGAADRVVL3X1lmLizcU1D/WFCaPjsAAQDPTUsAAAPCS0f/Xlf/XFo/Hx5hLCtpLC1UKSf/W1LVUEz/VlbPTkd0MTDGS0a9S0h7NS8jCwqONzXsXFUnFBJSIyGjQj6YPzxJHhs2GRg/GxqGODdeJSQeCwrsWVanREBBFhVJIBzcXVW9SkUXCwt9OTi4VVWpSkrtSDTvAAADZ0lEQVR4nO3bW1vaMBzH8TSdnGKNrTJlypSJYzo8b+//rS14ASQUmpaLJuz7uVL857G/J+kpIUIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA0cdavcm7VZ6bFsLKNKfnaUqAN03S3UXoq9Fq9Ft0LKSsapabisrVIjuNkN5UOTb+ty82HFY1MxehbS4E2HMuKY+05Da6KynhJIpU6aSVOiaqE8tppMPYIaDo5noTpd6dB79AS5jd2fT89tITWgZpLzlvVeRtbQnlrVWsx8QkYUUKV/7DuhuIur75TxJNQmT8NRKY7y+JMTL0GaSwJzV1tdO+UT5LDOg9V8dOufs69unDRNIqEqZw41ffS44ntM6AMJ+Guw1RPTvVASc8rTRLOc2m+9QWhSIs7u3iWmw995EUeTB/++rLD0Cme7Sp23JX+OwAAgIhkwn5xDlBWXRK/0DuhfaEMg/7RFufWIWZiuq1wi4fWIjmOU1mqeLTrbvKkvLCUkhfBvB9um8WYCL3qQ/PTrddc9+odP/x5mrHorFVpcVInYAwJ0759pfjtPckWS8JeZz2hFle1BmnwCc1Hp9bVviOu/SYRY0loBumVU+a1ahhNQqk2lraHqd96RSQJ1WLVMLMe2ryWtuNJmKTprVM1r3cahp5QjvKZXfSYey5XRJJQJQOn6Eke1nkolbtqOK/ZhWElLDm8/NmueSl8vgZluQhnde2+t6F4ra6p1m0lTpnOJut5JsvE4pOyut1aS+RldTPMms0qhT0FojdnIGrPSGShzGEAAIAy2rpV7/FoEs4tX6+zI2XmV91IW2G8rB1dpvfpiFBiPgxs1vyFFmeDpsZtJXI57/ju/IXnt55dUslw9j1ZEeTUuUS8NgoY1iyGlTB/sSdKZz6bnKJKOLf+pmuuGkaQUC4uD6tRqsVls4BhJlzsrkit/aKZuClqTrGFnXC0uSDz0exKGmjCRS++mYG5PkhPGwYMNWGSO6uG7zVXDQNPaM643rt9r6i5tB16wsTZa2ieScdNT8MwE0prQ+xnV84Tv31ckSRM1PqG2MWL02Mq1SElVIn7rHzUeJAGlfCju/ThvNL96e7jb0uB/O29dhTKG/CSs5aSZXtF1AHN0yw5S04BHiEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPg//AO9zTv9FO6XegAAAABJRU5ErkJggg==" alt="서버리스로 CronJob 만들기 (코로나 크롤러)"></span></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time datetime="2020-02-29T15:00:00.000Z" title="2020. 2. 29. 오전 7:00:00">2020-03-01</time>&nbsp;게시 됨</span><span class="level-item"><time datetime="2020-02-29T15:00:00.000Z" title="2020. 2. 29. 오전 7:00:00">2020-03-01</time>&nbsp;업데이트 됨</span><span class="level-item"><a class="link-muted" href="/categories/serverless/">serverless</a></span><span class="level-item">17분안에 읽기 (약 2489 단어)</span></div></div><h1 class="title is-3 is-size-4-mobile">서버리스로 CronJob 만들기 (코로나 크롤러)</h1><div class="content"><p>현재 진행하고 있는 프로젝트에서는 크로나 현황을 간단하게 보여주는 섹션이 존재하는데, 이 부분을 누군가가 (API 형식으로다가?) 제공해주고 있는 것으로 알고 있었다. 그렇지만 아직 나온 건 없었고, 어쩔 수 없이 간단한 크롤러를 만들고 업데이트 해주기로 했다. 현재 프로젝트가 서버리스로 돌고 있기도 하고, Scheduled 된 작업을 돌리기 위해서는 람다가 적합하지 않을라나 싶어서 같은 서버리스 프로젝트에서 크론잡을 돌리는 함수를 만들어보기로 했다.</p>
<span id="more"></span>

<p>이 글에서 정리하고 싶은 건, DynamoDB 리소스를 정해주는 작업, 크론잡을 만드는 것 정도가 될 것 같다. 프로젝트가 팀의 큰 프로젝트의 일부라, 그 외 디테일한 구조라든지, 세세한 과정을 모두 생략했다. 자세한 튜토리얼을 기대하고 읽으시는 분들은 원하는 만큼의 정보를 얻지 못할 것 같고, 간단하게 플로우를 확인하고자 하시는 분들에게 적절한 도움을 드릴 수 있지 않을까 싶다. 아마 서버리스로 간단한 TODO리스트 만들기를 데모로 처음부터 끝까지 써보려고 하는데, 그 글에서 자세한 서버리스 튜토리얼을 볼 수 있을 것 같다.</p>
<h2 id="크롤링하기"><a href="#크롤링하기" class="headerlink" title="크롤링하기"></a>크롤링하기</h2><p>이 부분은 네이버 검색에 나오는 부분을 크롤링 하기로 했다. 정확하게 우리가 원하는 데이터만 보여주는 화면이 있어서, 그 화면을 크롤링 해서 숫자만 가져가려고 한다. 크롤러는 <code>cheerio</code>를 사용했다. 크롤링 하는 부분은 이번 주제의 핵심이 아니니 간단하게 코드만 보고 가자.</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/services/utils/index.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> cheerio <span class="keyword">from</span> <span class="string">&quot;cheerio&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Axios</span> <span class="keyword">from</span> <span class="string">&quot;axios&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ScheduledEvent</span> &#125; <span class="keyword">from</span> <span class="string">&quot;aws-lambda&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="title class_">CoronaStatusModel</span> <span class="keyword">from</span> <span class="string">&quot;../../models/coronaStatusModel&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getCoronaData &#125; <span class="keyword">from</span> <span class="string">&quot;../../utils&quot;</span>;</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">cronCrawler</span> = <span class="keyword">async</span> (<span class="params">event: ScheduledEvent</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> data = <span class="keyword">await</span> <span class="title function_">getCoronaData</span>(event.<span class="property">time</span>);</span><br><span class="line">  <span class="keyword">const</span> latest = <span class="keyword">await</span> <span class="title class_">CoronaStatusModel</span>.<span class="title function_">getLatest</span>();</span><br><span class="line">  <span class="keyword">if</span> (latest) <span class="keyword">await</span> <span class="title class_">CoronaStatusModel</span>.<span class="title function_">updateLatest</span>(latest.<span class="property">date</span>, event.<span class="property">time</span>);</span><br><span class="line">  <span class="keyword">await</span> <span class="title class_">CoronaStatusModel</span>.<span class="title function_">create</span>(data <span class="keyword">as</span> <span class="title class_">CoronaStatusTableFields</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>우선, <code>getCoronaData</code> 함수에서는 테이블에 들어갈 데이터를 만들어온다. 이 부분에서 크롤링이 동작한다. 그 다음 현재 사용되고 있던 <code>latest</code> 버전을 찾아온 다음, <code>usage</code> 필드를 교체되는 시간으로 바꿔준다. 위와 같이 동작하게 한 이유는 다이나모디비 사용에 미숙한 이유가 있다. Date로 내림차순 한 다음, 맨 첫 번째 값만 가져오면 되는데, 이 부분을 아무리 찾아봐도 디테일한 레퍼런스를 찾지 못해서 (정말 흔한 케이스임에도 불구하고…), 특히 다이나모디비에서 오더링에 관한 내용이 <code>LocalSecondaryIndexes</code>를 설정해줘야 하는 걸로 나오게 되는데, 추가적인 비용이 나오기도 하고, 딱 이 기능 하나로 그 부분을 추가해야 하나 싶기도 하고 해서 … (변명이지만, 더 깊게 공부할 타이밍이 아니였다.) 아무튼 위와 같은 방식으로 <code>latest</code>를 항상 하나로 유지하게 하는 것으로 이후, 최근 값을 찾기 위해서는 <code>usage = &quot;latest&quot;</code>인 값만 찾게 했다. <code>CoronaStatusModel</code>은 나중에 살펴보도록 하자.</p>
<p><code>cheerio</code>가 동작하는 <code>getCoronaData</code> 함수는 다음과 같다.</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getCoronaData = <span class="keyword">async</span> (</span><br><span class="line">  <span class="attr">date</span>: <span class="built_in">string</span></span><br><span class="line">): <span class="title class_">Promise</span>&lt;<span class="title class_">CoronaStatusTableFields</span>&gt; =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;</span><br><span class="line">    <span class="attr">data</span>: html</span><br><span class="line">  &#125; = <span class="keyword">await</span> <span class="title class_">Axios</span>.<span class="title function_">get</span>(</span><br><span class="line">    <span class="string">&quot;https://search.naver.com/search.naver?sm=top_hty&amp;fbm=1&amp;ie=utf8&quot;</span>,</span><br><span class="line">    &#123; <span class="attr">params</span>: &#123; <span class="attr">query</span>: <span class="string">&quot;코로나&quot;</span> &#125; &#125;</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="attr">translateKeys</span>: &#123;</span><br><span class="line">    [P <span class="keyword">in</span> keyof <span class="title class_">CoronaStatusRawData</span>]: keyof <span class="title class_">CoronaStatusTableFields</span>;</span><br><span class="line">  &#125; = &#123;</span><br><span class="line">    검사진행: <span class="string">&quot;inspected&quot;</span>,</span><br><span class="line">    격리해제: <span class="string">&quot;isolationReleased&quot;</span>,</span><br><span class="line">    사망자: <span class="string">&quot;dead&quot;</span>,</span><br><span class="line">    확진환자: <span class="string">&quot;confirmed&quot;</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> $ = cheerio.<span class="title function_">load</span>(html);</span><br><span class="line">  <span class="keyword">const</span> $boxList = $(<span class="string">&quot;div.graph_view&quot;</span>).<span class="title function_">children</span>(<span class="string">&quot;.box&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> data = &#123;</span><br><span class="line">    <span class="attr">usage</span>: <span class="string">&quot;latest&quot;</span>,</span><br><span class="line">    date</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  $boxList.<span class="title function_">map</span>(<span class="function">(<span class="params">_index, box</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> key = $(box)</span><br><span class="line">      .<span class="title function_">find</span>(<span class="string">&quot;p span.txt_sort&quot;</span>)</span><br><span class="line">      .<span class="title function_">text</span>();</span><br><span class="line">    <span class="keyword">const</span> value = $(box)</span><br><span class="line">      .<span class="title function_">find</span>(<span class="string">&quot;p strong.num&quot;</span>)</span><br><span class="line">      .<span class="title function_">text</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> numValue = <span class="title class_">Number</span>(value.<span class="title function_">split</span>(<span class="string">&quot;,&quot;</span>).<span class="title function_">join</span>(<span class="string">&quot;&quot;</span>));</span><br><span class="line"></span><br><span class="line">    data[translateKeys[key]] = numValue;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> data <span class="keyword">as</span> <span class="title class_">CoronaStatusTableFields</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="Functions-설정하기"><a href="#Functions-설정하기" class="headerlink" title="Functions 설정하기"></a>Functions 설정하기</h2><p>이 부분에서 Schedule expression을 사용해서 특정 시간마다 함수가 돌 수 있게 만들어야 한다. Schedule expression의 문법은 크게 두 가지가 있다. 하나는 <code>rate</code>를 사용하는 것이고, 다른 하나는 <code>cron</code>을 사용하는 것이다.</p>
<h3 id="rate"><a href="#rate" class="headerlink" title="rate"></a>rate</h3><p>이 문법은 특정한 주기를 설정할 수가 있게 된다 (분, 시간, 일 등 단위마다 시작하는 형식으로). 기본적으로 형태는 <code>rate(value unit)</code> 형태를 띄고, <code>rate</code>를 사용하는 방법은 아래와 같다.</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">events:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">schedule:</span> <span class="string">rate(15</span> <span class="string">minutes)</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">schedule:</span> <span class="string">rate(1</span> <span class="string">hour)</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">schedule:</span> <span class="string">rate(2</span> <span class="string">days)</span></span><br></pre></td></tr></table></figure>

<p>위와 같이 값과 유닛단위를 적어줘야 하는데, 지원하고 있는 유닛들은 아래와 같다.</p>
<ul>
<li><code>minute</code> or <code>minutes</code></li>
<li><code>hour</code> or <code>hours</code></li>
<li><code>day</code> or <code>days</code></li>
</ul>
<p>값에 따라 복수형 단수형을 지켜 써줘야 한다고 한다 (아마 안될 것 같지는 않다).</p>
<h3 id="cron"><a href="#cron" class="headerlink" title="cron"></a>cron</h3><p>이 문법은 조금 더 복잡한 방식의 리눅스의 <code>crontab</code> 문법을 차용하고 있다고 한다. <code>cron(minute hour day-of-month month day-of-week year)</code> 형식의 문법을 사용한다. 쉼표를 가지고 여러 값을 넣을 수도 있고, 와일드카드(<code>?</code>, <code>*</code> 등)를 사용할 수 있다. 각 필드에 대한 타입과 와일드 카드들은 아래와 같다.</p>
<table>
<thead>
<tr>
<th align="center">Field</th>
<th align="left">Values</th>
<th align="left">WildCards</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Minutes</td>
<td align="left">0-59</td>
<td align="left">, - * &#x2F;</td>
</tr>
<tr>
<td align="center">Hours</td>
<td align="left">0-23</td>
<td align="left">, - * &#x2F;</td>
</tr>
<tr>
<td align="center">Day-of-month</td>
<td align="left">1-31</td>
<td align="left">, - * ? &#x2F; L W</td>
</tr>
<tr>
<td align="center">Month</td>
<td align="left">1-12 or JAN-DEC</td>
<td align="left">, - * &#x2F;</td>
</tr>
<tr>
<td align="center">Day-of-week</td>
<td align="left">1-7 or SUN-SAT</td>
<td align="left">, - * ? L #</td>
</tr>
<tr>
<td align="center">Year</td>
<td align="left">1970-2199</td>
<td align="left">, - * &#x2F;</td>
</tr>
</tbody></table>
<p>와일드카드들의 지원과 제한 등에 대해서는 여기 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://docs.aws.amazon.com/ko_kr/AmazonCloudWatch/latest/events/ScheduledEvents.html">아마존 링크</a>를 확인해보자. 영어로밖에 지원을 안해주는 페이지다.</p>
<p>아래는 <code>cron</code>의 예시이다.</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">event:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">schedule:</span> <span class="string">cron(15</span> <span class="number">3</span> <span class="string">?</span> <span class="string">*</span> <span class="string">MON</span> <span class="string">*)</span> <span class="comment"># 월요일 3:15AM 마다 도는 함수</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">schedule:</span> <span class="string">cron(1/10</span> <span class="string">*</span> <span class="string">?</span> <span class="string">*</span> <span class="string">W</span> <span class="string">*)</span></span><br><span class="line">    <span class="comment"># 주말 제외 시작하고나서 10분 마다 도는 함수</span></span><br><span class="line">    <span class="comment"># (run in 10-minute increments from the start of the hour on all working days)</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">schedule:</span> <span class="string">cron(0</span> <span class="number">18</span> <span class="string">*</span> <span class="string">*</span> <span class="string">?</span> <span class="string">*)</span> <span class="comment"># 매일 18:00에 동작하는 함수</span></span><br></pre></td></tr></table></figure>

<p>위 예시에서 계속 등장하는 몇 가지 와일드 카드들은 아래와 같은 의미가 있다.</p>
<ul>
<li><p><code>*</code>: 해당 필드의 모든 것을 의미한다. 예를 들어서 Hours Field의 <code>*</code>는, ‘모든 시간에 대해서’ 라는 의미를 갖는다. 이 와일드 카드는 <code>day-of-week</code> 필드와 <code>day-of-month</code> 둘 다에 사용할 수는 없고, 둘 중 하나는 반드시 <code>?</code>를 써야 한다.</p>
</li>
<li><p><code>?</code>: 해석을 하자니 모호해서… 우선 구체적인 예시는, <code>day-of-month</code>에 7을 넣고, 그 7일이 무슨 요일이든 상관이 없으면 <code>day-of-week</code>에 <code>?</code>를 쓸 수 있다.</p>
</li>
</ul>
<hr>
<p>일단 내가 작업하고 있는 일은 매일 오전 10시, 오후 5시에 작업이 돌아야 한다. <code>cron</code> 문법을 사용하는 것이 좋겠다. 다만 <code>cron</code>의 시간이 UTC만 지원하기 때문에 원하는 시간에서 9시간을 뺀 값으로 적어줘야 한다.</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># functions.yml</span></span><br><span class="line"></span><br><span class="line"><span class="attr">CronCoronaCrawler:</span></span><br><span class="line">  <span class="attr">handler:</span> <span class="string">./src/services/utils/index.cronCrawler</span></span><br><span class="line">  <span class="attr">events:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">schedule:</span> <span class="string">cron(0</span> <span class="number">1</span><span class="string">,8</span> <span class="string">*</span> <span class="string">*</span> <span class="string">?</span> <span class="string">*)</span> <span class="comment"># 10시, 17시</span></span><br></pre></td></tr></table></figure>

<p>이제 이 <code>functions.yml</code>을 <code>serverless.yml</code>의 <code>functions</code> 프로퍼티 쪽에 리스트 형식으로 <code>$&#123;file(path/to/functions.yml)&#125;</code> 이런 식으로 붙여주면 된다.</p>
<h2 id="Resource-설정하기"><a href="#Resource-설정하기" class="headerlink" title="Resource 설정하기"></a>Resource 설정하기</h2><p>데이터베이스를 붙여주고 <code>CoronaStatusModel</code>에서 사용된 함수들만 만들어주면 되겠다. (이미 프로젝트에서는 만들어둔 적이 있어서, 위에서 이미 사용된 체로 코드를 올렸다.) 다이나모디비를 붙여주자. tables를 아래와 같이 설정해줬다.</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># tables.yml</span></span><br><span class="line"><span class="attr">CoronaStatus:</span></span><br><span class="line">  <span class="attr">Type:</span> <span class="string">AWS::DynamoDB::Table</span></span><br><span class="line">  <span class="attr">DeletionPolicy:</span> <span class="string">Retain</span></span><br><span class="line">  <span class="attr">Properties:</span></span><br><span class="line">    <span class="attr">TableName:</span> <span class="string">$&#123;self:custom.TABLE_PREFIX&#125;corona-status</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">AttributeDefinitions:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">AttributeName:</span> <span class="string">date</span></span><br><span class="line">        <span class="attr">AttributeType:</span> <span class="string">S</span></span><br><span class="line">    <span class="attr">KeySchema:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">AttributeName:</span> <span class="string">date</span></span><br><span class="line">        <span class="attr">KeyType:</span> <span class="string">RANGE</span></span><br></pre></td></tr></table></figure>

<p><code>AttributeDefinition</code>은 <code>KeySchema</code>에 정의되어야 하는 필드만 넣어두었다. <code>ProvisionedThroughput</code>은 <code>BillingMode</code>가 <code>PROVISIONED</code>인 경우에는 반드시 정해줘야 하고 <code>PAY_PER_REQUEST</code>인 경우엔 정할 수 없다고 한다. 기본 값은 <code>PROVISIONED</code>이기 때문에 읽기는 초당 15, 쓰기는 초당 5로 지정했다.</p>
<p>마찬가지로, 이 <code>yml</code> 파일은 <code>serverless.yml</code>에 붙여준다.</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#...</span></span><br><span class="line"></span><br><span class="line"><span class="attr">resources:</span></span><br><span class="line">  <span class="attr">Resources:</span> <span class="string">$&#123;file(./migrations/tables.yml)&#125;</span></span><br><span class="line"><span class="comment">#...</span></span><br></pre></td></tr></table></figure>

<p><code>CoronaStatusModel</code>을 짠 곳이다.</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; dynamodb &#125; <span class="keyword">from</span> <span class="string">&quot;../common/aws&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">CORONA_STATUS_TABLE</span> &#125; <span class="keyword">from</span> <span class="string">&quot;../databases/dynamodb&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">create</span> = (<span class="params">data: CoronaStatusTableFields</span>) =&gt;</span><br><span class="line">  dynamodb</span><br><span class="line">    .<span class="title function_">put</span>(&#123;</span><br><span class="line">      <span class="title class_">TableName</span>: <span class="variable constant_">CORONA_STATUS_TABLE</span>,</span><br><span class="line">      <span class="title class_">Item</span>: data</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">promise</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getLatest = <span class="keyword">async</span> (): <span class="title class_">Promise</span>&lt;<span class="title class_">CoronaStatusTableFields</span>&gt; =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; <span class="title class_">Items</span> &#125; = <span class="keyword">await</span> dynamodb</span><br><span class="line">    .<span class="title function_">scan</span>(&#123;</span><br><span class="line">      <span class="title class_">TableName</span>: <span class="variable constant_">CORONA_STATUS_TABLE</span>,</span><br><span class="line">      <span class="title class_">FilterExpression</span>: <span class="string">&quot;#u = :usg&quot;</span>,</span><br><span class="line">      <span class="title class_">ExpressionAttributeNames</span>: &#123;</span><br><span class="line">        <span class="string">&quot;#u&quot;</span>: <span class="string">&quot;usage&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="title class_">ExpressionAttributeValues</span>: &#123;</span><br><span class="line">        <span class="string">&quot;:usg&quot;</span>: <span class="string">&quot;latest&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">promise</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Items</span>[<span class="number">0</span>] <span class="keyword">as</span> <span class="title class_">CoronaStatusTableFields</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">updateLatest</span> = (<span class="params">date: <span class="built_in">string</span>, usage: <span class="built_in">string</span></span>) =&gt;</span><br><span class="line">  dynamodb</span><br><span class="line">    .<span class="title function_">update</span>(&#123;</span><br><span class="line">      <span class="title class_">TableName</span>: <span class="variable constant_">CORONA_STATUS_TABLE</span>,</span><br><span class="line">      <span class="title class_">Key</span>: &#123; <span class="attr">date</span>: date &#125;,</span><br><span class="line">      <span class="title class_">UpdateExpression</span>: <span class="string">&quot;SET #u = :usage&quot;</span>,</span><br><span class="line">      <span class="title class_">ExpressionAttributeValues</span>: &#123;</span><br><span class="line">        <span class="string">&quot;:usage&quot;</span>: usage</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="title class_">ExpressionAttributeNames</span>: &#123;</span><br><span class="line">        <span class="string">&quot;#u&quot;</span>: <span class="string">&quot;usage&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">promise</span>();</span><br></pre></td></tr></table></figure>

<p>이제는 동작 해야 하는데, 테스트 하기 위해서 엔드포인트로 들어갔을 때 크롤링을 해서 데이터를 넣는 람다 함수도 만들어서 테스트를 해봤다.</p>
<p>서버리스 배포는 간단하게 <code>sls deploy --stage development</code>로 할 수 있다.</p>
<h2 id="후기"><a href="#후기" class="headerlink" title="후기"></a>후기</h2><p>서버리스가 크론잡을 돌리기엔 정말 간단하게 만들 수 있어서 좋았다. 앞으로도 이런 식으로 크론잡으로 데이터 모으는 프로그램은 별도로 람다를 만들 것 같다. 그렇지만 다이나모디비에 대해서는 그렇게 좋지 못한 경험이었다. 정말 간단한 것이지만 삽질한 것도 있고, 테이블 설계가 일반적이지 않아서 상당히 애를 먹었다. 물론 몇 번 더 시도 해보고 Secondary Indexes 등 구성해보는 시도를 하겠지만, 특별히 이점을 가져다주는 게 있는지 모르겠다. RDS를 연결 할 때 VPC 등 네트워크 설정을 해줘야 한다는 점? 그냥 그런식으로 연결 해주는게 오히려 정신 건강에 좋겠다 싶은 수준이었다. 물론 프로덕트에서도 많이들 쓰고 있는 것을 봤지만, 실제 메인 서비스에서 핵심 데이터베이스로 사용하고 있는 팀이 있는지 궁금하다. 다이나모디비는 여러번 더 봐야 할 필요를 느꼈다… 앞으로 몇 가지 태스크를 다이나모디비로 깨야 하는데 벌써 피로감이 드는 것 같다.</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://serverless.com/blog/cron-jobs-on-aws/">https://serverless.com/blog/cron-jobs-on-aws/</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://docs.aws.amazon.com/ko_kr/AmazonCloudWatch/latest/events/ScheduledEvents.html">https://docs.aws.amazon.com/ko_kr/AmazonCloudWatch/latest/events/ScheduledEvents.html</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://iseongho.github.io/posts/cron-expression/">https://iseongho.github.io/posts/cron-expression/</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/aws-properties-dynamodb-keyschema.html">https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/aws-properties-dynamodb-keyschema.html</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/aws-resource-dynamodb-table.html">https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/aws-resource-dynamodb-table.html</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://docs.aws.amazon.com/ko_kr/amazondynamodb/latest/developerguide/SecondaryIndexes.html">https://docs.aws.amazon.com/ko_kr/amazondynamodb/latest/developerguide/SecondaryIndexes.html</a></li>
</ul>
</div><div class="article-licensing box"><div class="licensing-title"><p>서버리스로 CronJob 만들기 (코로나 크롤러)</p><p><a href="https://changhoi.kim/posts/serverless/serverless-cronjob-crawler-demo/">https://changhoi.kim/posts/serverless/serverless-cronjob-crawler-demo/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>changhoi</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2020-03-01</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2020-03-01</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="external nofollow noopener noreferrer" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="external nofollow noopener noreferrer" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="external nofollow noopener noreferrer" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/lambda/">lambda</a><a class="link-muted mr-2" rel="tag" href="/tags/serverless/">serverless</a><a class="link-muted mr-2" rel="tag" href="/tags/dynamodb/">dynamodb</a><a class="link-muted mr-2" rel="tag" href="/tags/aws/">aws</a></div><div class="a2a_kit a2a_kit_size_32 a2a_default_style"><a class="a2a_dd" target="_blank" rel="external nofollow noopener noreferrer" href="https://www.addtoany.com/share"></a><a class="a2a_button_facebook"></a><a class="a2a_button_twitter"></a><a class="a2a_button_telegram"></a><a class="a2a_button_whatsapp"></a><a class="a2a_button_reddit"></a></div><script src="https://static.addtoany.com/menu/page.js" defer></script></article></div><div class="card"><div class="card-content"><h3 class="title is-5">관련 글</h3><article class="media"><figure class="media-left"><a class="image" href="/posts/database/dynamodb-internals-2/"><img src="/images/2022-04-16-dynamodb-internals-1/thumbnail.png" alt="DynamoDB Internals (2) - DynamoDB"></a></figure><div class="media-content"><p class="date"><time datetime="2022-04-18T15:00:00.000Z">2022-04-19</time></p><p class="title"><a href="/posts/database/dynamodb-internals-2/">DynamoDB Internals (2) - DynamoDB</a></p><p class="categories"><a href="/categories/database/">database</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/posts/database/dynamodb-internals-1/"><img src="/images/2022-04-16-dynamodb-internals-1/thumbnail.png" alt="DynamoDB Internals (1) - Dynamo"></a></figure><div class="media-content"><p class="date"><time datetime="2022-04-15T15:00:00.000Z">2022-04-16</time></p><p class="title"><a href="/posts/database/dynamodb-internals-1/">DynamoDB Internals (1) - Dynamo</a></p><p class="categories"><a href="/categories/database/">database</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/posts/database/dynamodb-single-table-design/"><img src="/images/2022-04-16-dynamodb-internals-1/thumbnail.png" alt="DynamoDB 설계 방법: Single Table Design"></a></figure><div class="media-content"><p class="date"><time datetime="2020-10-23T15:00:00.000Z">2020-10-24</time></p><p class="title"><a href="/posts/database/dynamodb-single-table-design/">DynamoDB 설계 방법: Single Table Design</a></p><p class="categories"><a href="/categories/database/">database</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/posts/backend/go-lambda-try/"><img src="https://upload.wikimedia.org/wikipedia/commons/d/df/Go_gopher_app_engine_color.jpg" alt="Golang + Lambda로 신규 유저 정보 이메일로 보내기 삽질기"></a></figure><div class="media-content"><p class="date"><time datetime="2020-07-08T15:00:00.000Z">2020-07-09</time></p><p class="title"><a href="/posts/backend/go-lambda-try/">Golang + Lambda로 신규 유저 정보 이메일로 보내기 삽질기</a></p><p class="categories"><a href="/categories/backend/">backend</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/posts/serverless/serverless-deployment-best-practices/"><img src="https://s3-us-west-2.amazonaws.com/assets.blog.serverless.com/2019-10-deployment-best-practices/safeguard-hero.png" alt="서버리스 배포 베스트 프랙티스(번역)"></a></figure><div class="media-content"><p class="date"><time datetime="2020-03-08T15:00:00.000Z">2020-03-09</time></p><p class="title"><a href="/posts/serverless/serverless-deployment-best-practices/">서버리스 배포 베스트 프랙티스(번역)</a></p><p class="categories"><a href="/categories/serverless/">serverless</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/posts/serverless/serverless-vpc-deploy-demo/"><img src="/images/2020-03-05-serverless-vpc-deploy-demo/thumbnail.png" alt="Serverless + S3 + DyanamoDB VPC에 배포하고 외부와 연결하기"></a></figure><div class="media-content"><p class="date"><time datetime="2020-03-04T15:00:00.000Z">2020-03-05</time></p><p class="title"><a href="/posts/serverless/serverless-vpc-deploy-demo/">Serverless + S3 + DyanamoDB VPC에 배포하고 외부와 연결하기</a></p><p class="categories"><a href="/categories/serverless/">serverless</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/posts/docker/fargate-demo/"><img src="https://cdn-images-1.medium.com/max/1600/1*YRdbz-SNDxCTnyPGJU347Q.jpeg" alt="컨테이너 서버리스 Fargate 배포하기"></a></figure><div class="media-content"><p class="date"><time datetime="2020-02-21T15:00:00.000Z">2020-02-22</time></p><p class="title"><a href="/posts/docker/fargate-demo/">컨테이너 서버리스 Fargate 배포하기</a></p><p class="categories"><a href="/categories/docker/">docker</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/posts/serverless/serverless-architecture-pattern/"><img src="https://miro.medium.com/max/730/1*Fjsk_yELuDAavR8sXOW6Sg.png" alt="서버리스 아키텍처 패턴"></a></figure><div class="media-content"><p class="date"><time datetime="2019-12-08T15:00:00.000Z">2019-12-09</time></p><p class="title"><a href="/posts/serverless/serverless-architecture-pattern/">서버리스 아키텍처 패턴</a></p><p class="categories"><a href="/categories/serverless/">serverless</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/posts/serverless/serverless-framework-quicklearn-(2)/"><img src="https://files.readme.io/ffb4c59-Serverless.png" alt="Serverless 프레임워크 빠르게 배우기 (2)"></a></figure><div class="media-content"><p class="date"><time datetime="2019-11-26T15:00:00.000Z">2019-11-27</time></p><p class="title"><a href="/posts/serverless/serverless-framework-quicklearn-(2)/">Serverless 프레임워크 빠르게 배우기 (2)</a></p><p class="categories"><a href="/categories/serverless/">serverless</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/posts/serverless/serverless-framework-quicklearn-(1)/"><img src="https://files.readme.io/ffb4c59-Serverless.png" alt="Serverless 프레임워크 빠르게 배우기 (1)"></a></figure><div class="media-content"><p class="date"><time datetime="2019-11-23T15:00:00.000Z">2019-11-24</time></p><p class="title"><a href="/posts/serverless/serverless-framework-quicklearn-(1)/">Serverless 프레임워크 빠르게 배우기 (1)</a></p><p class="categories"><a href="/categories/serverless/">serverless</a></p></div></article></div></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/posts/docker/Use-multiple-Dockerfiles-for-complex-application-configuration/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">복잡한 애플리케이션 설정을 위한 복수의 도커 파일 사용하기(번역)</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/posts/docker/fargate-demo/"><span class="level-item">컨테이너 서버리스 Fargate 배포하기</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card" id="comments"><div class="card-content"><h3 class="title is-5">댓글</h3><div class="fb-comments" data-width="100%" data-href="https://changhoi.kim/posts/serverless/serverless-cronjob-crawler-demo/" data-num-posts="5"></div><script>(function(d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) return;
            js = d.createElement(s); js.id = id;
            js.src = "//connect.facebook.net/ko/sdk.js#xfbml=1&version=v12.0";
            fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="https://avatars2.githubusercontent.com/u/34329147?s=400&amp;u=9d1b1dc88bc8ee5965f35b0160780264c3619eb6&amp;v=4" alt="Changhoi Kim"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Changhoi Kim</p><p class="is-size-6 is-block">Co-Founder of Bayesians</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Seoul, Korea</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">포스트</p><a href="/archives/"><p class="title">73</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">카테고리</p><a href="/categories/"><p class="title">13</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">태그</p><a href="/tags/"><p class="title">47</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://www.linkedin.com/in/changhoi/" target="_blank" rel="external nofollow noopener noreferrer">팔로우</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="external nofollow noopener noreferrer" title="LinkedIn" href="https://www.linkedin.com/in/changhoi/"><i class="fab fa-linkedin"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="external nofollow noopener noreferrer" title="Github" href="https://github.com/changhoi"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="external nofollow noopener noreferrer" title="Email" href="mailto:changhoi0522@gmail.com"><i class="fas fa-envelope-square"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="external nofollow noopener noreferrer" title="English" href="https://jayce.kim"><i class="fas fa-language"></i></a></div></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">카테고리</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/backend/"><span class="level-start"><span class="level-item">backend</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile" href="/categories/books/"><span class="level-start"><span class="level-item">books</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/database/"><span class="level-start"><span class="level-item">database</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile" href="/categories/docker/"><span class="level-start"><span class="level-item">docker</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/essay/"><span class="level-start"><span class="level-item">essay</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/etc/"><span class="level-start"><span class="level-item">etc</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile" href="/categories/go/"><span class="level-start"><span class="level-item">go</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/linux/"><span class="level-start"><span class="level-item">linux</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/logs/"><span class="level-start"><span class="level-item">logs</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/categories/network/"><span class="level-start"><span class="level-item">network</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/os/"><span class="level-start"><span class="level-item">os</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/rust/"><span class="level-start"><span class="level-item">rust</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/serverless/"><span class="level-start"><span class="level-item">serverless</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li></ul></div></div></div><div class="column-right-shadow is-hidden-widescreen is-sticky"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3 is-sticky"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">카탈로그</h3><ul class="menu-list"><li><a class="level is-mobile" href="#크롤링하기"><span class="level-left"><span class="level-item">1</span><span class="level-item">크롤링하기</span></span></a></li><li><a class="level is-mobile" href="#Functions-설정하기"><span class="level-left"><span class="level-item">2</span><span class="level-item">Functions 설정하기</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#rate"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">rate</span></span></a></li><li><a class="level is-mobile" href="#cron"><span class="level-left"><span class="level-item">2.2</span><span class="level-item">cron</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Resource-설정하기"><span class="level-left"><span class="level-item">3</span><span class="level-item">Resource 설정하기</span></span></a></li><li><a class="level is-mobile" href="#후기"><span class="level-left"><span class="level-item">4</span><span class="level-item">후기</span></span></a></li><li><a class="level is-mobile" href="#Reference"><span class="level-left"><span class="level-item">5</span><span class="level-item">Reference</span></span></a></li></ul></div></div><script src="/js/toc.js" defer></script></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.jpg" alt="Changhoi Kim" height="28"></a><p class="is-size-7"><span>&copy; 2025 changhoi</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="external nofollow noopener noreferrer">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="external nofollow noopener noreferrer">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="external nofollow noopener noreferrer" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="external nofollow noopener noreferrer" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("ko");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script data-pjax src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="맨 위로" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script data-pjax src="/js/back_to_top.js" defer></script><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><div id="outdated"><h6>Your browser is out-of-date!</h6><p>Update your browser to view this website correctly.&amp;npsb;<a id="btnUpdateBrowser" target="_blank" rel="external nofollow noopener noreferrer" href="http://outdatedbrowser.com/">Update my browser now </a></p><p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">×</a></p></div><script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script><script>window.addEventListener("load", function () {
            outdatedBrowser({
                bgColor: '#f25648',
                color: '#ffffff',
                lowerThan: 'object-fit' // display on IE11 or below
            });
        });</script><!--!--><script data-pjax src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="입력 하세요..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script data-pjax src="/js/insight.js" defer></script><script data-pjax>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"입력 하세요...","untitled":"(제목 없음)","posts":"포스트","pages":"페이지","categories":"카테고리","tags":"태그"});
        });</script></body></html>