<!doctype html>
<html lang="ko"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>도커 베스트 프랙티스 (번역) - Changhoi Kim</title><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="white"><meta name="application-name" content="Changhoi Kim"><meta name="msapplication-TileImage" content="/img/favicon.ico"><meta name="msapplication-TileColor" content="white"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Changhoi Kim"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="깃헙에는 현재 백만이 넘는 도커파일들이 있다. 하지만 모든 도커파일들이 동일하지는 않다. 효율성은 중요한 것이고, 이번 블로그 시리즈는 도커파일의 다섯 가지 영역: 빌드 시간의 증가, 이미지의 사이즈, 유지성, 보안, 반복성에 있어서 베스트 프랙티스를 다룰 것이다. 만약 독자가 도커에 막 시작하는 사람이라면, 이 글은 독자를 위한 글이다! 이후 시리즈는 좀"><meta property="og:type" content="blog"><meta property="og:title" content="도커 베스트 프랙티스 (번역)"><meta property="og:url" content="https://changhoi.kim/posts/docker/Docker-best-practices/"><meta property="og:site_name" content="Changhoi Kim"><meta property="og:description" content="깃헙에는 현재 백만이 넘는 도커파일들이 있다. 하지만 모든 도커파일들이 동일하지는 않다. 효율성은 중요한 것이고, 이번 블로그 시리즈는 도커파일의 다섯 가지 영역: 빌드 시간의 증가, 이미지의 사이즈, 유지성, 보안, 반복성에 있어서 베스트 프랙티스를 다룰 것이다. 만약 독자가 도커에 막 시작하는 사람이라면, 이 글은 독자를 위한 글이다! 이후 시리즈는 좀"><meta property="og:locale" content="ko_KR"><meta property="og:image" content="https://cdn-media-1.freecodecamp.org/images/0*mgaoUlIJzr502lhY.jpg"><meta property="article:published_time" content="2020-03-03T15:00:00.000Z"><meta property="article:modified_time" content="2020-03-03T15:00:00.000Z"><meta property="article:author" content="changhoi"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://cdn-media-1.freecodecamp.org/images/0*mgaoUlIJzr502lhY.jpg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://changhoi.kim/posts/docker/Docker-best-practices/"},"headline":"도커 베스트 프랙티스 (번역)","image":["https://cdn-media-1.freecodecamp.org/images/0*mgaoUlIJzr502lhY.jpg"],"datePublished":"2020-03-03T15:00:00.000Z","dateModified":"2020-03-03T15:00:00.000Z","author":{"@type":"Person","name":"changhoi"},"publisher":{"@type":"Organization","name":"Changhoi Kim","logo":{"@type":"ImageObject","url":"https://changhoi.kim/img/logo.jpg"}},"description":"깃헙에는 현재 백만이 넘는 도커파일들이 있다. 하지만 모든 도커파일들이 동일하지는 않다. 효율성은 중요한 것이고, 이번 블로그 시리즈는 도커파일의 다섯 가지 영역: 빌드 시간의 증가, 이미지의 사이즈, 유지성, 보안, 반복성에 있어서 베스트 프랙티스를 다룰 것이다. 만약 독자가 도커에 막 시작하는 사람이라면, 이 글은 독자를 위한 글이다! 이후 시리즈는 좀"}</script><link rel="canonical" href="https://changhoi.kim/posts/docker/Docker-best-practices/"><link rel="alternate" href="/rss2.xml" title="Changhoi Kim" type="application/atom+xml"><link rel="icon" href="/img/favicon.ico"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link data-pjax rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link data-pjax rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=G-QBSLW6WTZW" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'G-QBSLW6WTZW');</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css"><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.jpg" alt="Changhoi Kim" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item is-hidden-tablet catalogue" title="카탈로그" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="검색" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><div class="card-image"><span class="image is-7by3"><img class="fill" src="https://cdn-media-1.freecodecamp.org/images/0*mgaoUlIJzr502lhY.jpg" alt="도커 베스트 프랙티스 (번역)"></span></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time datetime="2020-03-03T15:00:00.000Z" title="2020. 3. 3. 오전 7:00:00">2020-03-04</time>&nbsp;게시 됨</span><span class="level-item"><time datetime="2020-03-03T15:00:00.000Z" title="2020. 3. 3. 오전 7:00:00">2020-03-04</time>&nbsp;업데이트 됨</span><span class="level-item"><a class="link-muted" href="/categories/docker/">docker</a></span><span class="level-item">22분안에 읽기 (약 3239 단어)</span></div></div><h1 class="title is-3 is-size-4-mobile">도커 베스트 프랙티스 (번역)</h1><div class="content"><p>깃헙에는 현재 백만이 넘는 도커파일들이 있다. 하지만 모든 도커파일들이 동일하지는 않다. 효율성은 중요한 것이고, 이번 블로그 시리즈는 도커파일의 다섯 가지 영역: 빌드 시간의 증가, 이미지의 사이즈, 유지성, 보안, 반복성에 있어서 베스트 프랙티스를 다룰 것이다. 만약 독자가 도커에 막 시작하는 사람이라면, 이 글은 독자를 위한 글이다! 이후 시리즈는 좀 더 Advanced한 주제가 될 것이다.</p>
<span id="more"></span>

<blockquote>
<p>Important note: 아래의 이 팁들은 메이븐을 기반으로한 자바 프로젝트의 도커파일을 향상시키는 일련의 과정이다. 마지막 도커파일이 결국에 추천하는 도커파일이 될 것이고, 모든 중간 과정들은, 구체적인 베스트 프랙티스를 설명하기 위한 과정이다.</p>
</blockquote>
<h2 id="Incremental-build-time"><a href="#Incremental-build-time" class="headerlink" title="Incremental build time"></a>Incremental build time</h2><p>개발 사이클에서, 코드를 변경시키고, 다시 빌드 하면서 도커 이미지를 빌드할 때, 캐시를 활용하는 것은 중요하다. 캐싱은 불필요한 빌드 과정을 동작하는 것을 피하게 만든다.</p>
<h3 id="Tip-1-캐싱에는-순서가-중요하다"><a href="#Tip-1-캐싱에는-순서가-중요하다" class="headerlink" title="Tip #1: 캐싱에는 순서가 중요하다."></a>Tip #1: 캐싱에는 순서가 중요하다.</h3><p><img src="https://i1.wp.com/www.docker.com/blog/wp-content/uploads/2019/07/ef41db8f-fe5e-4a78-940a-6a929db7929d-1.jpg?ssl=1"></p>
<p>빌드 단계 (도커파일의 Instructions)의 순서는 중요한데, 왜냐하면 하나의 스탭의 캐시가, 파일이 바뀌거나, 도커파일의 라인을 수정함으로써 유효하지 않게 되었을 때, 이어지는 단계들의 캐시가 깨질 것이기 때문이다. 너의 Instruction 순서를 최소로 수정되는 것에서 자주 수정되는 순서대로 정렬해야 캐싱을 최적화 할 수 있다.</p>
<h3 id="Tip-2-캐시가-깨지는-것을-제한하기-위해서-더-구체적인-COPY를-사용해라"><a href="#Tip-2-캐시가-깨지는-것을-제한하기-위해서-더-구체적인-COPY를-사용해라" class="headerlink" title="Tip #2: 캐시가 깨지는 것을 제한하기 위해서 더 구체적인 COPY를 사용해라"></a>Tip #2: 캐시가 깨지는 것을 제한하기 위해서 더 구체적인 <code>COPY</code>를 사용해라</h3><p><img src="https://i1.wp.com/www.docker.com/blog/wp-content/uploads/2019/07/0c1d0c4e-406c-468c-b6ba-b71ac68b9c84.jpg?ssl=1"></p>
<p>꼭 필요한 것만 카피해라. 되도록 <code>COPY .</code>와 같은 인스트럭션은 피해라. 너의 이미지에 파일들을 카피해 넣을 때, 너가 아주 구체적으로 너가 원하는 카피 대상을 지정하도록 해라. 카피한 어떠한 파일의 변경점은 캐시를 무효화 한다. 위 예시에서, 오직 미리 빌드된 jar 앱만 이미지 내에서 필요하다. 그러므로 딱 그것만 카피해라. 이 방법으로 연관 없는 파일의 변경점은 캐시에 영향을 주지 않게 된다.</p>
<h3 id="Tip-3-apt-get-update-install과-같은-캐싱-가능한-단위를-일원화-해라"><a href="#Tip-3-apt-get-update-install과-같은-캐싱-가능한-단위를-일원화-해라" class="headerlink" title="Tip #3: apt-get update &amp; install과 같은 캐싱 가능한 단위를 일원화 해라"></a>Tip #3: <code>apt-get update &amp; install</code>과 같은 캐싱 가능한 단위를 일원화 해라</h3><p><img src="https://i2.wp.com/www.docker.com/blog/wp-content/uploads/2019/07/2322a39e-bd7e-4a2b-9a8f-548a97dbacb4.jpg?ssl=1"></p>
<p>각 <code>RUN</code> 인스트럭션은 캐싱 가능한 실행의 단위라고 볼 수 있다. 너무 많은 체이닝으로 명령을 하는 것은 캐시를 무효화(breaking)할 수 있기 때문에 조심해야 하지만, 너무 많이 있는 것은 불필요하다. 패키지를 패키지 매니저에서 설치할 때는, 너는 항상 같은 <code>RUN</code> 인스트럭션에서 인덱스를 업데이트하고 그리고 패키지를 설치하고 싶어한다: 그것들은 함께 하나의 캐싱 가능한 유닛을 형성한다. 이 방법을 사용하지 않으면, 너는 outdated된 패키지를 설치할 위험이 있다.</p>
<h2 id="Reduce-image-size"><a href="#Reduce-image-size" class="headerlink" title="Reduce image size"></a>Reduce image size</h2><p>작은 이미지들은 빠른 배포와 더 작은 공격 표면(attack surface?)과 이어지기 때문에, 이미지 사이즈는 중요하다.</p>
<h3 id="Tip-4-불필요한-의존성들을-제거해라"><a href="#Tip-4-불필요한-의존성들을-제거해라" class="headerlink" title="Tip #4: 불필요한 의존성들을 제거해라"></a>Tip #4: 불필요한 의존성들을 제거해라</h3><p><img src="https://i0.wp.com/www.docker.com/blog/wp-content/uploads/2019/07/a1b36f64-1a30-45bf-8fcd-4f88437c189e.jpg?ssl=1"></p>
<p>불필요한 의존성을 제거하고 필요한 디버깅 툴이 나중에 설치될 수도 있는 것이면, 디버깅 툴을 설치하지 말아라. 특별한 패키지 매니저(apt와 같은)는 자동적으로 user-specified 패키지들을 불필요한 footprint를 남기면서 설치한다. Apt는 실제로는 불필요한 의존성을 설치하지 않는 <code>--no-install-recommends</code> 플래그가 있다. 그것(해당 옵션으로 인해 설치되지 않은)들이 필요한 경우 명시적으로 그것(필요한 의존성)을 더해라</p>
<h3 id="Tip-5-패키지-매니저의-캐시를-삭제해라"><a href="#Tip-5-패키지-매니저의-캐시를-삭제해라" class="headerlink" title="Tip #5: 패키지 매니저의 캐시를 삭제해라"></a>Tip #5: 패키지 매니저의 캐시를 삭제해라</h3><p><img src="https://i2.wp.com/www.docker.com/blog/wp-content/uploads/2019/07/363961a4-005e-46fc-963b-f7b690be12ef.jpg?ssl=1"></p>
<p>패키지 매니저들은 그들 스스로의 캐시를 보관한다. 그것들은 결국엔 이미지가 된다. 이것을 해결하는 방법은 패키지를 설치한 같은 <code>RUN</code> 인스트럭션에서 캐시를 삭제하는 것이다. 이것을 다른 <code>RUN</code> 인스트럭션에서 지우게 되면, 이미지 사이즈를 줄이지 못한다.</p>
<p>멀티 스테이지 빌드에서 이미지 사이즈를 줄이는 몇 가지 방법들을 마지막에 다룰 것이다. 다음 베스트 프랙티스는 유지성(maintainability), 보안성, 반복 가능성(repeatability)를 어떻게 최적화 할지에 대해서 다룬다.</p>
<h2 id="Maintainability"><a href="#Maintainability" class="headerlink" title="Maintainability"></a>Maintainability</h2><h3 id="Tip-6-가능한-공식-이미지들을-사용해라"><a href="#Tip-6-가능한-공식-이미지들을-사용해라" class="headerlink" title="Tip #6: 가능한 공식 이미지들을 사용해라"></a>Tip #6: 가능한 공식 이미지들을 사용해라</h3><p><img src="https://i2.wp.com/www.docker.com/blog/wp-content/uploads/2019/07/f336014d-d2aa-4c1b-a2bd-e1d5d6ed0d93.jpg?ssl=1"></p>
<p>공식 이미지들은 유지에 많은 시간 소비를 하는 것을 막아준다. 모든 인스톨 과정이 완료 되어있고, 베스트 프랙티스가 적용되어 있기 때문이다. 다양한 프로젝트들이 있다면, 그들이 정확히 같은 베이스 이미지를 사용하기 때문에 그들은 그들의 레이어들을 공유할 수 있다.</p>
<h3 id="Tip-7-더-구체적인-태그들을-사용해라"><a href="#Tip-7-더-구체적인-태그들을-사용해라" class="headerlink" title="Tip #7: 더 구체적인 태그들을 사용해라"></a>Tip #7: 더 구체적인 태그들을 사용해라</h3><p><img src="https://i1.wp.com/www.docker.com/blog/wp-content/uploads/2019/07/9d991da9-bdb9-4108-8b36-296a5a3772aa.jpg?ssl=1"></p>
<p><code>latest</code> 태그를 사용하지 말아라. 이것은 도커 허브에 있는 공식 이미지들에게 항상 사용가능한 편리한 방법이지만, 가끔은 큰 변화들이 있을 수 있다. 얼마나 오랜 시간을 해당 베이스 이미지를 가지고 개발 했는지에 따라서 도커파일을 캐시 없이 다시 빌드 시켰을 때, 빌드 되지 않을 수 있다.</p>
<p>대신 더 구체적인 태그들을 사용해라. 위 경우는 <code>openjdk</code>를 사용하고 있다. 더 많은 태그들을 사용할 수 있으니 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://hub.docker.com/_/openjdk">도커 허브 문서</a>를 확인해라</p>
<h3 id="Tip-8-최소한의-flavors-지원기능-를-찾아라"><a href="#Tip-8-최소한의-flavors-지원기능-를-찾아라" class="headerlink" title="Tip #8: 최소한의 flavors(지원기능)를 찾아라"></a>Tip #8: 최소한의 flavors(지원기능)를 찾아라</h3><p><img src="https://i1.wp.com/www.docker.com/blog/wp-content/uploads/2019/07/6c486200-5198-4457-86c0-b5275e70e699.jpg?ssl=1"></p>
<p>이 태그들 중 어떤 것들은 최소한의 flavors를 가지고 있는데, 그럴수록 이미지는 더 작다. <code>jre-slim</code> 버전은 최소한의 데비안 이미지를 베이스로 하는데, 더 작은 <code>jre-alpine</code> 버전은 알파인 리눅스 배포판을 기반으로 만들어져 있다. 눈에 띄는 차이점은 데비안은 <code>GNU libc</code>를 사용하는 반면, 알파인은 더 작지만, 몇 가지 성능 이슈들을 야기할 수 있는 <code>mucl libc</code>를 사용한다. 이번 케이스인 <code>openjdk</code>의 경우, (아마 알파인이) sdk가 아니라 java 런타임만 담고 있기 때문에 이것은 극적으로 이미지를 줄일 수 있게 만들어준다.</p>
<h2 id="Reproducibility"><a href="#Reproducibility" class="headerlink" title="Reproducibility"></a>Reproducibility</h2><p>지금까지 도커파일들은 너의 <code>jar artifact</code>가 호스트에서 빌드된다고 가정하고 있었다. 이건 너가 컨테이너가 제공해주는 일관적인 환경의 혜택을 잃는다는 점에서 이상적이지는 않다. 예를 들어서 만약 너의 자바 앱이 특정 라이브러리들에 의존하고 있다면, 그것은 아마 어떤 컴퓨터에서 앱이 빌드되는지에 따른 일관적이지 않게 되는 것들을 환영하지 않을 것이다.</p>
<h3 id="Tip-9-일관적인-환경에서-소스를-빌드해라"><a href="#Tip-9-일관적인-환경에서-소스를-빌드해라" class="headerlink" title="Tip #9: 일관적인 환경에서 소스를 빌드해라"></a>Tip #9: 일관적인 환경에서 소스를 빌드해라</h3><p>소스 코드는 너가 빌드하고자 하는 도커 이미지의 <code>source of truth</code>이다. 그 도커파일은 간단히 말해 청사진이다.</p>
<p><img src="https://i0.wp.com/www.docker.com/blog/wp-content/uploads/2019/07/f393ad07-c25d-4241-a40f-c6168e0ba4dd.jpg?ssl=1"></p>
<p>너는 너의 앱을 빌드하기 위해 필요한 모든 것들을 일원화 하는 것으로서 시작할 필요가 있다. 우리의 간단한 자바 앱은 Maven과 JDK를 필요로 한다. 그러므로 우리의 도커파일을 구체적이고 최소화된 공식 maven 이미지 기반으로 하도록 하자. 만약 너가 더 많은 의존성을 설치해야 한다면, <code>RUN</code> 인스트럭션을 통해 추가할 수 있다.</p>
<p><code>pom.xml</code>과 소스 폴더들은 마지막 <code>mvn package</code>와 함께 <code>app.jar</code>을 생성하는 <code>RUN</code> 단계에서 필요하기 때문에 복사된다. (<code>-e</code> 플래그는 에러를 보여주기 위한 것이고, <code>-B</code>는 <code>batch</code> 모드로 동작시키기 위한 것이다.)</p>
<p>우리는 비일관적인 환경 문제를 해결했다. 하지만 다른 한 가지 방법이 있다: 코드가 바뀔 때마다, 모든 <code>pom.xml</code>에 정의된 모든 의존성들이 받아와진다. 다음 팁에서 고쳐보자.</p>
<h3 id="Tip-10-의존성을-각-분리된-단계에서-가져오자"><a href="#Tip-10-의존성을-각-분리된-단계에서-가져오자" class="headerlink" title="Tip #10: 의존성을 각 분리된 단계에서 가져오자"></a>Tip #10: 의존성을 각 분리된 단계에서 가져오자</h3><p><img src="https://i0.wp.com/www.docker.com/blog/wp-content/uploads/2019/07/41ea71ce-11c3-42a3-8d2b-05fe20901745.jpg?ssl=1"></p>
<p>위에서 언급했던 ‘캐시 가능한 실행의 단위’들이라는 것을 다시 생각해봄으로써, 우리는 의존성을 받아오는 것이 소스 코드에 의존적인 것이 아니라 <code>pom.xml</code>이 변경되는 것에만 의존하는 분리된 캐시 가능한 유닛이라는 것을 확신할 수가 있다. 두 <code>COPY</code> 단계 사이에 <code>RUN</code> 단계에서 Maven에게 의존성을 가져오라고 지시한다.</p>
<p>일관된 환경속에서 빌딩하는 것에 대해 소개된 내용 중에 한 가지 문제가 더 있다: 이미지가 런타임에는 필요하지 않은 빌드 타임의 모든 의존성을 포함하고 있기 때문에, 우리 이미지가 이전보다 더 커진다.</p>
<h3 id="Tip-11-빌드-의존성을-제거하기-위해-멀티-스테이지-빌드를-사용해라-최종-버전"><a href="#Tip-11-빌드-의존성을-제거하기-위해-멀티-스테이지-빌드를-사용해라-최종-버전" class="headerlink" title="Tip #11: 빌드 의존성을 제거하기 위해 멀티 스테이지 빌드를 사용해라 (최종 버전)"></a>Tip #11: 빌드 의존성을 제거하기 위해 멀티 스테이지 빌드를 사용해라 (최종 버전)</h3><p><img src="https://i2.wp.com/www.docker.com/blog/wp-content/uploads/2019/07/97ec1992-f0df-4c8f-82a0-e177c230e5c5.jpg?ssl=1"></p>
<p>멀티 스테이지 빌드는 여러 개의 <code>FROM</code> 인스트럭션에서 확인할 수 있다. 각 <code>FROM</code>은 새로운 스테이지를 시작한다. 그들은 <code>AS</code>라는 키워드(위 이미지에서 우리 첫 <code>FROM</code> 스테이지를 나중의 참조를 위해 <code>builder</code>라고 이름 붙인)로 이름 붙여질 수 있다.</p>
<p>두 번째 스테이지는 최종 이미지를 내보낼 우리의 최종적 스테이지이다. 이것은 제한적으로 런타임에 필요로 하는 것을 담을 것이다. 이 경우에는 최소한의 알파인 베이스의 JRE를 담고 있다. 중간적인 빌드 스테이지는 캐시될 것이지만, 최종 이미지에 제공되지는 않는다. artifacts를 최종 이미지에 넣기 위해서 <code>COPY --from=STAGE_NAME</code>을 사용한다. 위 이미지에서는 <code>builder</code>가 되겠다.</p>
<p><img src="https://i2.wp.com/www.docker.com/blog/wp-content/uploads/2019/07/80c3c350-5f7e-4cf1-ab3e-89df755b3c33.jpg?ssl=1"></p>
<p>멀티 스테이지 빌드는 빌드 타임의 의존성을 제거하는 해결책이 된다.</p>
<p>우리는 빵빵하고, 일관적이지 않게 빌드 하는 것에서 최소한의 이미지를 일관적인 환경에서, 캐시 친화적으로 빌드하는 것으로 왔다. 다음 블로그 포스트에서 우리는 멀티 스테이지 빌드에 대해서 더 자세하게 다룰 예정이다.</p>
<h2 id="후기"><a href="#후기" class="headerlink" title="후기"></a>후기</h2><p>정말 좋은 꿀팁들을 많이 얻었다. 초보를 위한 글이라고 도입에서 말한 것처럼 초보에게 정말 많은 도움이 되었다. 글이 순서대로, 쉽게 잘 읽혀서 타입스크립트에서도 바로 적용할 수 있을 것 같다. 도커 블로그 자주 애용해야겠다. 읽고 이해하기가 어렵지 않았는데 한글로 이해하기 쉽게 글을 고치는 것이 너무 익숙하지 않아 글이 훼손된 느낌이다. 여러번 해보다 보면 나아지겠거나 하고 있다.</p>
<h2 id="원본"><a href="#원본" class="headerlink" title="원본"></a>원본</h2><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.docker.com/blog/intro-guide-to-dockerfile-best-practices/?fbclid=IwAR2IvfL95fHkckX1Hq9F0ARfOCbSjjpMgu7nPwNRsf3S8kz1QAvZfrXW3D8">https://www.docker.com/blog/intro-guide-to-dockerfile-best-practices/?fbclid=IwAR2IvfL95fHkckX1Hq9F0ARfOCbSjjpMgu7nPwNRsf3S8kz1QAvZfrXW3D8</a></p>
</div><div class="article-licensing box"><div class="licensing-title"><p>도커 베스트 프랙티스 (번역)</p><p><a href="https://changhoi.kim/posts/docker/Docker-best-practices/">https://changhoi.kim/posts/docker/Docker-best-practices/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>changhoi</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2020-03-04</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2020-03-04</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="external nofollow noopener noreferrer" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="external nofollow noopener noreferrer" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="external nofollow noopener noreferrer" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="a2a_kit a2a_kit_size_32 a2a_default_style"><a class="a2a_dd" target="_blank" rel="external nofollow noopener noreferrer" href="https://www.addtoany.com/share"></a><a class="a2a_button_facebook"></a><a class="a2a_button_twitter"></a><a class="a2a_button_telegram"></a><a class="a2a_button_whatsapp"></a><a class="a2a_button_reddit"></a></div><script src="https://static.addtoany.com/menu/page.js" defer></script></article></div><div class="card"><div class="card-content"><h3 class="title is-5">관련 글</h3><article class="media"><figure class="media-left"><a class="image" href="/posts/docker/Use-multiple-Dockerfiles-for-complex-application-configuration/"><img src="https://cdn.ttgtmedia.com/visuals/searchCloudComputing/infrastructure/cloudcomputing_article_011.jpg" alt="복잡한 애플리케이션 설정을 위한 복수의 도커 파일 사용하기(번역)"></a></figure><div class="media-content"><p class="date"><time datetime="2020-03-01T15:00:00.000Z">2020-03-02</time></p><p class="title"><a href="/posts/docker/Use-multiple-Dockerfiles-for-complex-application-configuration/">복잡한 애플리케이션 설정을 위한 복수의 도커 파일 사용하기(번역)</a></p><p class="categories"><a href="/categories/docker/">docker</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/posts/docker/fargate-demo/"><img src="https://cdn-images-1.medium.com/max/1600/1*YRdbz-SNDxCTnyPGJU347Q.jpeg" alt="컨테이너 서버리스 Fargate 배포하기"></a></figure><div class="media-content"><p class="date"><time datetime="2020-02-21T15:00:00.000Z">2020-02-22</time></p><p class="title"><a href="/posts/docker/fargate-demo/">컨테이너 서버리스 Fargate 배포하기</a></p><p class="categories"><a href="/categories/docker/">docker</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/posts/docker/docker-development-env-(2)/"><img src="https://live.staticflickr.com/778/22947137613_69a88cb94b_b.jpg" alt="Docker로 개발 환경 구축하기 (2)"></a></figure><div class="media-content"><p class="date"><time datetime="2019-11-20T15:00:00.000Z">2019-11-21</time></p><p class="title"><a href="/posts/docker/docker-development-env-(2)/">Docker로 개발 환경 구축하기 (2)</a></p><p class="categories"><a href="/categories/docker/">docker</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/posts/docker/docker-development-env-(1)/"><img src="https://live.staticflickr.com/778/22947137613_69a88cb94b_b.jpg" alt="Docker로 개발 환경 구축하기 (1)"></a></figure><div class="media-content"><p class="date"><time datetime="2019-11-13T15:00:00.000Z">2019-11-14</time></p><p class="title"><a href="/posts/docker/docker-development-env-(1)/">Docker로 개발 환경 구축하기 (1)</a></p><p class="categories"><a href="/categories/docker/">docker</a></p></div></article></div></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/posts/serverless/serverless-vpc-deploy-demo/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Serverless + S3 + DyanamoDB VPC에 배포하고 외부와 연결하기</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/posts/docker/Use-multiple-Dockerfiles-for-complex-application-configuration/"><span class="level-item">복잡한 애플리케이션 설정을 위한 복수의 도커 파일 사용하기(번역)</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card" id="comments"><div class="card-content"><h3 class="title is-5">댓글</h3><div class="fb-comments" data-width="100%" data-href="https://changhoi.kim/posts/docker/Docker-best-practices/" data-num-posts="5"></div><script>(function(d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) return;
            js = d.createElement(s); js.id = id;
            js.src = "//connect.facebook.net/ko/sdk.js#xfbml=1&version=v12.0";
            fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="https://avatars2.githubusercontent.com/u/34329147?s=400&amp;u=9d1b1dc88bc8ee5965f35b0160780264c3619eb6&amp;v=4" alt="Changhoi Kim"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Changhoi Kim</p><p class="is-size-6 is-block">Co-Founder of Bayesians</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Seoul, Korea</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">포스트</p><a href="/archives/"><p class="title">73</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">카테고리</p><a href="/categories/"><p class="title">13</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">태그</p><a href="/tags/"><p class="title">47</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://www.linkedin.com/in/changhoi/" target="_blank" rel="external nofollow noopener noreferrer">팔로우</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="external nofollow noopener noreferrer" title="LinkedIn" href="https://www.linkedin.com/in/changhoi/"><i class="fab fa-linkedin"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="external nofollow noopener noreferrer" title="Github" href="https://github.com/changhoi"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="external nofollow noopener noreferrer" title="Email" href="mailto:changhoi0522@gmail.com"><i class="fas fa-envelope-square"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="external nofollow noopener noreferrer" title="English" href="https://jayce.kim"><i class="fas fa-language"></i></a></div></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">카테고리</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/backend/"><span class="level-start"><span class="level-item">backend</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile" href="/categories/books/"><span class="level-start"><span class="level-item">books</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/database/"><span class="level-start"><span class="level-item">database</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile" href="/categories/docker/"><span class="level-start"><span class="level-item">docker</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/essay/"><span class="level-start"><span class="level-item">essay</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/etc/"><span class="level-start"><span class="level-item">etc</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile" href="/categories/go/"><span class="level-start"><span class="level-item">go</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/linux/"><span class="level-start"><span class="level-item">linux</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/logs/"><span class="level-start"><span class="level-item">logs</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/categories/network/"><span class="level-start"><span class="level-item">network</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/os/"><span class="level-start"><span class="level-item">os</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/rust/"><span class="level-start"><span class="level-item">rust</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/serverless/"><span class="level-start"><span class="level-item">serverless</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li></ul></div></div></div><div class="column-right-shadow is-hidden-widescreen is-sticky"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3 is-sticky"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">카탈로그</h3><ul class="menu-list"><li><a class="level is-mobile" href="#Incremental-build-time"><span class="level-left"><span class="level-item">1</span><span class="level-item">Incremental build time</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Tip-1-캐싱에는-순서가-중요하다"><span class="level-left"><span class="level-item">1.1</span><span class="level-item">Tip #1: 캐싱에는 순서가 중요하다.</span></span></a></li><li><a class="level is-mobile" href="#Tip-2-캐시가-깨지는-것을-제한하기-위해서-더-구체적인-COPY를-사용해라"><span class="level-left"><span class="level-item">1.2</span><span class="level-item">Tip #2: 캐시가 깨지는 것을 제한하기 위해서 더 구체적인 COPY를 사용해라</span></span></a></li><li><a class="level is-mobile" href="#Tip-3-apt-get-update-install과-같은-캐싱-가능한-단위를-일원화-해라"><span class="level-left"><span class="level-item">1.3</span><span class="level-item">Tip #3: apt-get update &amp; install과 같은 캐싱 가능한 단위를 일원화 해라</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Reduce-image-size"><span class="level-left"><span class="level-item">2</span><span class="level-item">Reduce image size</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Tip-4-불필요한-의존성들을-제거해라"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">Tip #4: 불필요한 의존성들을 제거해라</span></span></a></li><li><a class="level is-mobile" href="#Tip-5-패키지-매니저의-캐시를-삭제해라"><span class="level-left"><span class="level-item">2.2</span><span class="level-item">Tip #5: 패키지 매니저의 캐시를 삭제해라</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Maintainability"><span class="level-left"><span class="level-item">3</span><span class="level-item">Maintainability</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Tip-6-가능한-공식-이미지들을-사용해라"><span class="level-left"><span class="level-item">3.1</span><span class="level-item">Tip #6: 가능한 공식 이미지들을 사용해라</span></span></a></li><li><a class="level is-mobile" href="#Tip-7-더-구체적인-태그들을-사용해라"><span class="level-left"><span class="level-item">3.2</span><span class="level-item">Tip #7: 더 구체적인 태그들을 사용해라</span></span></a></li><li><a class="level is-mobile" href="#Tip-8-최소한의-flavors-지원기능-를-찾아라"><span class="level-left"><span class="level-item">3.3</span><span class="level-item">Tip #8: 최소한의 flavors(지원기능)를 찾아라</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Reproducibility"><span class="level-left"><span class="level-item">4</span><span class="level-item">Reproducibility</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Tip-9-일관적인-환경에서-소스를-빌드해라"><span class="level-left"><span class="level-item">4.1</span><span class="level-item">Tip #9: 일관적인 환경에서 소스를 빌드해라</span></span></a></li><li><a class="level is-mobile" href="#Tip-10-의존성을-각-분리된-단계에서-가져오자"><span class="level-left"><span class="level-item">4.2</span><span class="level-item">Tip #10: 의존성을 각 분리된 단계에서 가져오자</span></span></a></li><li><a class="level is-mobile" href="#Tip-11-빌드-의존성을-제거하기-위해-멀티-스테이지-빌드를-사용해라-최종-버전"><span class="level-left"><span class="level-item">4.3</span><span class="level-item">Tip #11: 빌드 의존성을 제거하기 위해 멀티 스테이지 빌드를 사용해라 (최종 버전)</span></span></a></li></ul></li><li><a class="level is-mobile" href="#후기"><span class="level-left"><span class="level-item">5</span><span class="level-item">후기</span></span></a></li><li><a class="level is-mobile" href="#원본"><span class="level-left"><span class="level-item">6</span><span class="level-item">원본</span></span></a></li></ul></div></div><script src="/js/toc.js" defer></script></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.jpg" alt="Changhoi Kim" height="28"></a><p class="is-size-7"><span>&copy; 2025 changhoi</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="external nofollow noopener noreferrer">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="external nofollow noopener noreferrer">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="external nofollow noopener noreferrer" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="external nofollow noopener noreferrer" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("ko");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script data-pjax src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="맨 위로" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script data-pjax src="/js/back_to_top.js" defer></script><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><div id="outdated"><h6>Your browser is out-of-date!</h6><p>Update your browser to view this website correctly.&amp;npsb;<a id="btnUpdateBrowser" target="_blank" rel="external nofollow noopener noreferrer" href="http://outdatedbrowser.com/">Update my browser now </a></p><p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">×</a></p></div><script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script><script>window.addEventListener("load", function () {
            outdatedBrowser({
                bgColor: '#f25648',
                color: '#ffffff',
                lowerThan: 'object-fit' // display on IE11 or below
            });
        });</script><!--!--><script data-pjax src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="입력 하세요..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script data-pjax src="/js/insight.js" defer></script><script data-pjax>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"입력 하세요...","untitled":"(제목 없음)","posts":"포스트","pages":"페이지","categories":"카테고리","tags":"태그"});
        });</script></body></html>