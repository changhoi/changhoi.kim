<!doctype html>
<html lang="ko"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Golang + Lambda로 신규 유저 정보 이메일로 보내기 삽질기 - Changhoi Kim</title><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="white"><meta name="application-name" content="Changhoi Kim"><meta name="msapplication-TileImage" content="/img/favicon.ico"><meta name="msapplication-TileColor" content="white"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Changhoi Kim"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="이번 글은 실패한 사례를 공유해두려고 한다. 실패라기 보다는 몰랐던 사실 때문에 방법을 수정하게 되었다. 결론적으로 말하자면, EC2에 스케줄링 하는 방식으로 수정되었다. 다만 람다에 배포하고 CloudWatch Event를 사용해 스케줄링 하는 과정까지는 진행했고, 해당 과정을 담았다.  서비스 중인 앱 중에서는 회원가입 신청한 유저의 신원을 직접 확인"><meta property="og:type" content="blog"><meta property="og:title" content="Golang + Lambda로 신규 유저 정보 이메일로 보내기 삽질기"><meta property="og:url" content="https://changhoi.kim/posts/backend/go-lambda-try/"><meta property="og:site_name" content="Changhoi Kim"><meta property="og:description" content="이번 글은 실패한 사례를 공유해두려고 한다. 실패라기 보다는 몰랐던 사실 때문에 방법을 수정하게 되었다. 결론적으로 말하자면, EC2에 스케줄링 하는 방식으로 수정되었다. 다만 람다에 배포하고 CloudWatch Event를 사용해 스케줄링 하는 과정까지는 진행했고, 해당 과정을 담았다.  서비스 중인 앱 중에서는 회원가입 신청한 유저의 신원을 직접 확인"><meta property="og:locale" content="ko_KR"><meta property="og:image" content="https://upload.wikimedia.org/wikipedia/commons/d/df/Go_gopher_app_engine_color.jpg"><meta property="article:published_time" content="2020-07-08T15:00:00.000Z"><meta property="article:modified_time" content="2020-07-08T15:00:00.000Z"><meta property="article:author" content="changhoi"><meta property="article:tag" content="go"><meta property="article:tag" content="lambda"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://upload.wikimedia.org/wikipedia/commons/d/df/Go_gopher_app_engine_color.jpg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://changhoi.kim/posts/backend/go-lambda-try/"},"headline":"Golang + Lambda로 신규 유저 정보 이메일로 보내기 삽질기","image":["https://upload.wikimedia.org/wikipedia/commons/d/df/Go_gopher_app_engine_color.jpg"],"datePublished":"2020-07-08T15:00:00.000Z","dateModified":"2020-07-08T15:00:00.000Z","author":{"@type":"Person","name":"changhoi"},"publisher":{"@type":"Organization","name":"Changhoi Kim","logo":{"@type":"ImageObject","url":"https://changhoi.kim/img/logo.jpg"}},"description":"이번 글은 실패한 사례를 공유해두려고 한다. 실패라기 보다는 몰랐던 사실 때문에 방법을 수정하게 되었다. 결론적으로 말하자면, EC2에 스케줄링 하는 방식으로 수정되었다. 다만 람다에 배포하고 CloudWatch Event를 사용해 스케줄링 하는 과정까지는 진행했고, 해당 과정을 담았다.  서비스 중인 앱 중에서는 회원가입 신청한 유저의 신원을 직접 확인"}</script><link rel="canonical" href="https://changhoi.kim/posts/backend/go-lambda-try/"><link rel="alternate" href="/rss2.xml" title="Changhoi Kim" type="application/atom+xml"><link rel="icon" href="/img/favicon.ico"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link data-pjax rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link data-pjax rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=G-QBSLW6WTZW" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'G-QBSLW6WTZW');</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css"><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.jpg" alt="Changhoi Kim" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item is-hidden-tablet catalogue" title="카탈로그" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="검색" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><div class="card-image"><span class="image is-7by3"><img class="fill" src="https://upload.wikimedia.org/wikipedia/commons/d/df/Go_gopher_app_engine_color.jpg" alt="Golang + Lambda로 신규 유저 정보 이메일로 보내기 삽질기"></span></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time datetime="2020-07-08T15:00:00.000Z" title="2020. 7. 8. 오전 8:00:00">2020-07-09</time>&nbsp;게시 됨</span><span class="level-item"><time datetime="2020-07-08T15:00:00.000Z" title="2020. 7. 8. 오전 8:00:00">2020-07-09</time>&nbsp;업데이트 됨</span><span class="level-item"><a class="link-muted" href="/categories/backend/">backend</a></span><span class="level-item">15분안에 읽기 (약 2252 단어)</span></div></div><h1 class="title is-3 is-size-4-mobile">Golang + Lambda로 신규 유저 정보 이메일로 보내기 삽질기</h1><div class="content"><blockquote>
<p>이번 글은 실패한 사례를 공유해두려고 한다. 실패라기 보다는 몰랐던 사실 때문에 방법을 수정하게 되었다. 결론적으로 말하자면, EC2에 스케줄링 하는 방식으로 수정되었다. 다만 람다에 배포하고 CloudWatch Event를 사용해 스케줄링 하는 과정까지는 진행했고, 해당 과정을 담았다.</p>
</blockquote>
<p>서비스 중인 앱 중에서는 회원가입 신청한 유저의 신원을 직접 확인한 후 Activate를 해줘야 하는 부분이 있다. 회원 가입 후, 비개발인력이 데이터베이스에서 새롭게 가입한 유저를 확인하고, 몇 가지 확인과 등록 절차를 통해 유저를 등록시켜야 하는데, 비개발 인력이 하기 어려운 작업이라 매일 오전 9시에 전날 새로 가입한 유저 정보를 CSV로 만들고 메일로 보내는 스케줄링 작업을 Go로 만들어보려고 한다. 먼저 데이터베이스에서 내용을 가져와 CSV로 만들어내는 부분을 만든 다음, 메일 보내기 작업을 한 다음 RDS에 연결한 Lambda 배포까지 진행해보려고 한다.</p>
<span id="more"></span>

<h2 id="서비스-코드-작성하기"><a href="#서비스-코드-작성하기" class="headerlink" title="서비스 코드 작성하기"></a>서비스 코드 작성하기</h2><p>우선 Go 언어 사용이 생소하기 때문에 디렉토리 구조나 개발 환경에 대한 고민을 많이 했다. 가장 상위 <code>src</code> 디렉토리 아래, 테이블을 정의하는 <code>models</code> 디렉토리, ORM 로직을 담는 <code>orm</code> 디렉토리, 서비스 로직을 담는 <code>services</code>, 실행되는 <code>main.go</code> 형태로 구성했다. 먼저 만든 부분은 ORM에서 조건에 맞춰 쿼리를 넣는 작업이다.</p>
<p>데이터베이스는 PostgreSQL을 사용하고 있었고, 우리에게 필요한 부분은 <strong>전날 가입한 사람들</strong>이다. 먼저 이미 데이터베이스에 정의된 모델을 아래와 같이 가져오도록 정의했다.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/models/models.go</span></span><br><span class="line"><span class="keyword">package</span> models</span><br><span class="line"></span><br><span class="line"><span class="comment">// Pharm pharm model</span></span><br><span class="line"><span class="keyword">type</span> Pharm <span class="keyword">struct</span> &#123;</span><br><span class="line"> ID             <span class="type">int</span>    <span class="string">`gorm:&quot;Column:id&quot; json:&quot;id&quot;`</span></span><br><span class="line"> Name           <span class="type">string</span> <span class="string">`gorm:&quot;Column:name&quot; json:&quot;name&quot;`</span></span><br><span class="line"> Username       <span class="type">string</span> <span class="string">`gorm:&quot;Column:username&quot; json:&quot;username&quot;`</span></span><br><span class="line"> JibunAddr      <span class="type">string</span> <span class="string">`gorm:&quot;Column:jibunAddr&quot; json:&quot;jibunAddr&quot;`</span></span><br><span class="line"> RoadAddr       <span class="type">string</span> <span class="string">`gorm:&quot;Column:roadAddr&quot; json:&quot;roadAddr&quot;`</span></span><br><span class="line"> DetailAddr     <span class="type">string</span> <span class="string">`gorm:&quot;Column:detailAddr&quot; json:&quot;detailAddr&quot;`</span></span><br><span class="line"> Location       <span class="type">string</span> <span class="string">`gorm:&quot;Column:location&quot; json:&quot;location&quot;`</span></span><br><span class="line"> PharmacistName <span class="type">string</span> <span class="string">`gorm:&quot;Column:pharmacistName&quot; json:&quot;pharmacistName&quot;`</span></span><br><span class="line"> Tel            <span class="type">string</span> <span class="string">`gorm:&quot;Column:tel&quot; json:&quot;tel&quot;`</span></span><br><span class="line"> Phone          <span class="type">string</span> <span class="string">`gorm:&quot;Column:phone&quot; json:&quot;phone&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// TableName pharm table name</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(Pharm)</span></span> TableName() <span class="type">string</span> &#123;</span><br><span class="line"> <span class="keyword">return</span> <span class="string">&quot;pharm&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Go의 ORM으로 잘 알려진 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://gorm.io/docs/">gorm</a>을 사용하고 있다. 우리에게 필요한 모델을 설정했으니, 이제 쿼리를 작성해보자. 우선 데이터베이스를 연결하고, 연결된 데이터베이스를 넘겨주는 함수를 만들었다. </p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/orm/layer.go</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> orm</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"> <span class="string">&quot;github.com/jinzhu/gorm&quot;</span></span><br><span class="line"> <span class="comment">// orm driver</span></span><br><span class="line"> _ <span class="string">&quot;github.com/jinzhu/gorm/dialects/postgres&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// DBORM orm</span></span><br><span class="line"><span class="keyword">type</span> DBORM <span class="keyword">struct</span> &#123;</span><br><span class="line"> *gorm.DB</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NewORM get new orm setting</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewORM</span><span class="params">(config <span class="type">string</span>)</span></span> (*DBORM, <span class="type">error</span>) &#123;</span><br><span class="line"></span><br><span class="line"> db, err := gorm.Open(<span class="string">&quot;postgres&quot;</span>, config)</span><br><span class="line"> <span class="keyword">return</span> &amp;DBORM&#123;</span><br><span class="line">  DB: db,</span><br><span class="line"> &#125;, err</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>로직은 메인함수에서 진행이 되도록 작성했다.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/main.go</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"> <span class="string">&quot;bdygMailScheduler/src/orm&quot;</span></span><br><span class="line"> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"> <span class="string">&quot;log&quot;</span></span><br><span class="line"> <span class="string">&quot;os&quot;</span></span><br><span class="line"></span><br><span class="line"> <span class="string">&quot;github.com/joho/godotenv&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line"> godotenv.Load()</span><br><span class="line"></span><br><span class="line"> DB_HOST := os.Getenv(<span class="string">&quot;DB_HOST&quot;</span>)</span><br><span class="line"> DB_USER := os.Getenv(<span class="string">&quot;DB_USER&quot;</span>)</span><br><span class="line"> DB_NAME := os.Getenv(<span class="string">&quot;DB_NAME&quot;</span>)</span><br><span class="line"> DB_PASSWORD := os.Getenv(<span class="string">&quot;DB_PASSWORD&quot;</span>)</span><br><span class="line"></span><br><span class="line"> ormConfig := fmt.Sprintf(<span class="string">&quot;host=%s port=5432 user=%s dbname=%s password=%s&quot;</span>, DB_HOST, DB_USER, DB_NAME, DB_PASSWORD)</span><br><span class="line"></span><br><span class="line"> db, err := orm.NewORM(ormConfig)</span><br><span class="line"> <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">  <span class="built_in">panic</span>(err)</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">defer</span> db.Close()</span><br><span class="line"></span><br><span class="line"> pharms, err := orm.GetYesterdayNewbie(db)</span><br><span class="line"></span><br><span class="line"> log.Print(pharms, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ORM 로직을 아래와 같이 작성했다. 전날 가입한 유저의 정보를 가져오는 로직이다.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/orm/orm.go</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> orm</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;bdygMailScheduler/src/models&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// GetYesterdayNewbie 어제 가입한 약사 유저 리스트</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetYesterdayNewbie</span><span class="params">(db *DBORM)</span></span> (pharms []models.Pharm, err <span class="type">error</span>) &#123;</span><br><span class="line"> <span class="keyword">return</span> pharms, db.Select([]<span class="type">string</span>&#123;<span class="string">`name`</span>, <span class="string">`username`</span>, <span class="string">`&quot;jibunAddr&quot;`</span>, <span class="string">`&quot;roadAddr&quot;`</span>, <span class="string">`&quot;detailAddr&quot;`</span>, <span class="string">`&quot;pharmacistName&quot;`</span>, <span class="string">`location`</span>, <span class="string">`tel`</span>, <span class="string">`phone`</span>, <span class="string">`&quot;createdAt&quot;`</span>&#125;).Find(&amp;pharms, <span class="string">`date(&quot;createdAt&quot;) = current_date - 1`</span>).Error</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>위와 같이 메인함수와 ORM로직을 작성한 다음, 서비스 코드를 작성했다. 핵심적인 서비스를 다루는 로직은 <code>src/services</code> 아래 두었다. csv를 만드는 서비스와 메일을 보내는 서비스를 따로 분리했다.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/services/csvService.go</span></span><br><span class="line"><span class="keyword">package</span> services</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"> <span class="string">&quot;bdygMailScheduler/src/models&quot;</span></span><br><span class="line"> <span class="string">&quot;os&quot;</span></span><br><span class="line"></span><br><span class="line"> <span class="string">&quot;github.com/gocarina/gocsv&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// GetCsv create csv data</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetCsv</span><span class="params">(newbieList []models.Pharm)</span></span> <span class="type">string</span> &#123;</span><br><span class="line"> key := <span class="string">&quot;/tmp/newbie.csv&quot;</span></span><br><span class="line"> file, err := os.Create(key)</span><br><span class="line"> <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">  <span class="built_in">panic</span>(err)</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">if</span> err := gocsv.MarshalFile(newbieList, file); err != <span class="literal">nil</span> &#123;</span><br><span class="line">  <span class="built_in">panic</span>(err)</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">return</span> key</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>위에서 한 가지 삽질했던 것이 있는데, 람다에서는 <code>/tmp</code> 임시적으로 파일을 생성할 수 있다고 한다.</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/services/mailService.go</span></span><br><span class="line"><span class="keyword">package</span> services</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"> <span class="string">&quot;time&quot;</span></span><br><span class="line"></span><br><span class="line"> <span class="string">&quot;gopkg.in/gomail.v2&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// From email sender</span></span><br><span class="line"><span class="keyword">type</span> From <span class="keyword">struct</span> &#123;</span><br><span class="line"> Email    <span class="type">string</span></span><br><span class="line"> Password <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// SendMail send data</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">SendMail</span><span class="params">(from From, to []<span class="type">string</span>, attachment <span class="type">string</span>)</span></span> &#123;</span><br><span class="line"> current := time.Now().Local()</span><br><span class="line"> subject := fmt.Sprintf(<span class="string">&quot;%s 새로운 약국 가입자&quot;</span>, current.Format(<span class="string">&quot;2006-01-02&quot;</span>))</span><br><span class="line"></span><br><span class="line"> m := gomail.NewMessage()</span><br><span class="line"> m.SetHeader(<span class="string">&quot;From&quot;</span>, from.Email)</span><br><span class="line"> m.SetHeader(<span class="string">&quot;To&quot;</span>, to...)</span><br><span class="line"> m.SetHeader(<span class="string">&quot;Subject&quot;</span>, subject)</span><br><span class="line"> m.Attach(attachment)</span><br><span class="line"></span><br><span class="line"> d := gomail.NewDialer(<span class="string">&quot;smtp.gmail.com&quot;</span>, <span class="number">587</span>, from.Email, from.Password)</span><br><span class="line"></span><br><span class="line"> <span class="keyword">if</span> err := d.DialAndSend(m); err != <span class="literal">nil</span> &#123;</span><br><span class="line">  <span class="built_in">panic</span>(err)</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>서비스 코드를 작성했으니, 메인 함수에서 동작하게 호출해줬다.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/main.go</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"> <span class="string">&quot;bdygMailScheduler/src/orm&quot;</span></span><br><span class="line"> <span class="string">&quot;bdygMailScheduler/src/services&quot;</span></span><br><span class="line"> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"> <span class="string">&quot;os&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"> DB_HOST := os.Getenv(<span class="string">&quot;DB_HOST&quot;</span>)</span><br><span class="line"> DB_USER := os.Getenv(<span class="string">&quot;DB_USER&quot;</span>)</span><br><span class="line"> DB_NAME := os.Getenv(<span class="string">&quot;DB_NAME&quot;</span>)</span><br><span class="line"> DB_PASSWORD := os.Getenv(<span class="string">&quot;DB_PASSWORD&quot;</span>)</span><br><span class="line"> EMAIL := os.Getenv(<span class="string">&quot;EMAIL&quot;</span>)</span><br><span class="line"> PASSWORD := os.Getenv(<span class="string">&quot;PASSWORD&quot;</span>)</span><br><span class="line"></span><br><span class="line"> ormConfig := fmt.Sprintf(<span class="string">&quot;host=%s port=5432 user=%s dbname=%s password=%s&quot;</span>, DB_HOST, DB_USER, DB_NAME, DB_PASSWORD)</span><br><span class="line"></span><br><span class="line"> db, err := orm.NewORM(ormConfig)</span><br><span class="line"> <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">  <span class="built_in">panic</span>(err)</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">defer</span> db.Close()</span><br><span class="line"></span><br><span class="line"> pharms, err := orm.GetYesterdayNewbie(db)</span><br><span class="line"> <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">  <span class="built_in">panic</span>(err)</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> count := <span class="built_in">len</span>(pharms)</span><br><span class="line"> <span class="keyword">if</span> count == <span class="number">0</span> &#123;</span><br><span class="line">  <span class="keyword">return</span></span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> csvKey := services.GetCsv(pharms)</span><br><span class="line"> <span class="keyword">defer</span> os.Remove(csvKey)</span><br><span class="line"> emailSender := services.From&#123;Email: EMAIL, Password: PASSWORD&#125;</span><br><span class="line"> to := []<span class="type">string</span>&#123;EMAIL&#125;</span><br><span class="line"></span><br><span class="line"> services.SendMail(emailSender, to, csvKey)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>이 정도로 작성한 뒤, 로컬에서 동작시켜보니 올바르게 작동했다. 이제 람다에 올리고 CloudWatch Event에 스케줄링을 해두면 되겠다고 생각했다.</p>
<blockquote>
<p>Gsuite의 보안 수준이 낮은 앱에서 로그인이 안되는 문제가 있었지만 2단계 인증 이후 앱 비밀번호?를 설정해 해당 비밀번호를 사용하게 했다.</p>
</blockquote>
<p>람다에 올리는 과정은 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://docs.aws.amazon.com/ko_kr/lambda/latest/dg/golang-handler.html">공식 문서</a>를 참고 했는데, 람다 함수의 진입점으로 설정해줘야 하는 부분이 있어서 아래와 같이 메인함수를 수정해줬다.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/main.go</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"> <span class="string">&quot;bdygMailScheduler/src/orm&quot;</span></span><br><span class="line"> <span class="string">&quot;bdygMailScheduler/src/services&quot;</span></span><br><span class="line"> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"> <span class="string">&quot;os&quot;</span></span><br><span class="line"></span><br><span class="line"> <span class="string">&quot;github.com/aws/aws-lambda-go/lambda&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// HandleRequest Go lambda function</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">HandleRequest</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line"> DB_HOST := os.Getenv(<span class="string">&quot;DB_HOST&quot;</span>)</span><br><span class="line"> DB_USER := os.Getenv(<span class="string">&quot;DB_USER&quot;</span>)</span><br><span class="line"> DB_NAME := os.Getenv(<span class="string">&quot;DB_NAME&quot;</span>)</span><br><span class="line"> DB_PASSWORD := os.Getenv(<span class="string">&quot;DB_PASSWORD&quot;</span>)</span><br><span class="line"> EMAIL := os.Getenv(<span class="string">&quot;EMAIL&quot;</span>)</span><br><span class="line"> PASSWORD := os.Getenv(<span class="string">&quot;PASSWORD&quot;</span>)</span><br><span class="line"></span><br><span class="line"> ormConfig := fmt.Sprintf(<span class="string">&quot;host=%s port=5432 user=%s dbname=%s password=%s&quot;</span>, DB_HOST, DB_USER, DB_NAME, DB_PASSWORD)</span><br><span class="line"></span><br><span class="line"> db, err := orm.NewORM(ormConfig)</span><br><span class="line"> <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">  <span class="built_in">panic</span>(err)</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">defer</span> db.Close()</span><br><span class="line"></span><br><span class="line"> pharms, err := orm.GetYesterdayNewbie(db)</span><br><span class="line"> <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">  <span class="built_in">panic</span>(err)</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> count := <span class="built_in">len</span>(pharms)</span><br><span class="line"> <span class="keyword">if</span> count == <span class="number">0</span> &#123;</span><br><span class="line">  <span class="keyword">return</span></span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> csvKey := services.GetCsv(pharms)</span><br><span class="line"> <span class="keyword">defer</span> os.Remove(csvKey)</span><br><span class="line"> emailSender := services.From&#123;Email: EMAIL, Password: PASSWORD&#125;</span><br><span class="line"> to := []<span class="type">string</span>&#123;EMAIL&#125;</span><br><span class="line"></span><br><span class="line"> services.SendMail(emailSender, to, csvKey)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"> lambda.Start(HandleRequest)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="람다에-배포하기"><a href="#람다에-배포하기" class="headerlink" title="람다에 배포하기"></a>람다에 배포하기</h2><p>서버리스 프레임워크도 Golang을 지원하지만, 이번에는 간단하기도 하고 하나의 함수만 넣는 작업이기 때문에, 직접 콘솔을 사용했다. 함수는 zip으로 압축한 다음, 콘솔에서 직접 업로드 했다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GOOS=linux go build src/main.go</span><br><span class="line">zip function.zip main</span><br></pre></td></tr></table></figure>

<p>일반적으로 람다를 만들듯 <code>함수 생성하기</code>를 통해 함수를 만든 다음, RDS를 사용하기 위해서 VPC 내부로 설정을 해줬다. VPC로 연결하기 위해서는 다음과 같은 권한을 요구로 한다. (역할 정책에 다음과 같은 권한을 추가해줘야 한다.)</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;Version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2012-10-17&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;Statement&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;Effect&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Allow&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;Action&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;ec2:DescribeNetworkInterfaces&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;ec2:CreateNetworkInterface&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;ec2:DeleteNetworkInterface&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;ec2:DescribeInstances&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;ec2:AttachNetworkInterface&quot;</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;Resource&quot;</span><span class="punctuation">:</span> <span class="string">&quot;*&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><img src="/images/2020-03-11-go-lambda-try/01.png?style=centerme"></p>
<p>EventBridge를 통해 크론잡을 추가해준다. 크론잡에 대해서는 <a href="/posts/serverless/serverless-cronjob-crawler-demo/">이 글</a>에서 한 번 다룬 적이 있다. 우리는 매일 오전 아홉시에 해당 이메일이 오길 원하기 때문에 아래와 같은 표현식을 사용했다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cron(0 18 * * ? *)</span><br></pre></td></tr></table></figure>

<h2 id="발생한-문제"><a href="#발생한-문제" class="headerlink" title="발생한 문제"></a>발생한 문제</h2><p>문제가 발생한 곳은 외부 네트워크로 요청을 보내는 것에 있었다. 메일을 보내는 부분에서 timeout이 발생했는데, VPC의 Public subnet에 위치시켜도 마찬가지였다. 친절하기로 소문난 AWSKRUG 슬랙 채널에 질문을 드린 결과 VPC 내부에 위치시켰을 때 Public, Private 상관 없이 외부 네트워크 요청을 할 때 IGW를 통하지 못한다는 답변을 받게 되었다. 그래서 해결 방안으로는 NAT Gateway를 만들거나, VPC Endpoint를 사용해서 SES를 쓰는 것이다. (또는 이번 태스크에서 선택한 람다를 포기하는 것…)</p>
<h2 id="결론"><a href="#결론" class="headerlink" title="결론"></a>결론</h2><p>아쉽게도 람다를 포기했다. 이번 태스크에서 사용하기 위해 Go와 GORM을 공부하면서 시간 소비가 좀 있기도 했고, NAT Gateway로 간단하게 해결하자니 추가되는 금액을 부담할만한 사항이 아닌 것 같고… 해서 EC2에서 스케줄링을 넣기로 했다.</p>
<h2 id="후기"><a href="#후기" class="headerlink" title="후기"></a>후기</h2><p>좋은 삽질이었다. Go언어로 만든 첫 프로젝트라서 재미도 느꼈다. 다른 프로젝트도 Go를 사용해보고 싶다.</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://docs.aws.amazon.com/ko_kr/lambda/latest/dg/golang-handler.html">https://docs.aws.amazon.com/ko_kr/lambda/latest/dg/golang-handler.html</a></li>
</ul>
</div><div class="article-licensing box"><div class="licensing-title"><p>Golang + Lambda로 신규 유저 정보 이메일로 보내기 삽질기</p><p><a href="https://changhoi.kim/posts/backend/go-lambda-try/">https://changhoi.kim/posts/backend/go-lambda-try/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>changhoi</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2020-07-09</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2020-07-09</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="external nofollow noopener noreferrer" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="external nofollow noopener noreferrer" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="external nofollow noopener noreferrer" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/go/">go</a><a class="link-muted mr-2" rel="tag" href="/tags/lambda/">lambda</a></div><div class="a2a_kit a2a_kit_size_32 a2a_default_style"><a class="a2a_dd" target="_blank" rel="external nofollow noopener noreferrer" href="https://www.addtoany.com/share"></a><a class="a2a_button_facebook"></a><a class="a2a_button_twitter"></a><a class="a2a_button_telegram"></a><a class="a2a_button_whatsapp"></a><a class="a2a_button_reddit"></a></div><script src="https://static.addtoany.com/menu/page.js" defer></script></article></div><div class="card"><div class="card-content"><h3 class="title is-5">관련 글</h3><article class="media"><figure class="media-left"><a class="image" href="/posts/backend/grpc-internals/"><img src="/images/2022-02-22-grpc-internals/thumbnail.png" alt="gRPC를 지탱하는 기술"></a></figure><div class="media-content"><p class="date"><time datetime="2022-02-21T15:00:00.000Z">2022-02-22</time></p><p class="title"><a href="/posts/backend/grpc-internals/">gRPC를 지탱하는 기술</a></p><p class="categories"><a href="/categories/backend/">backend</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/posts/backend/https-dive/"><img src="/images/2021-08-13-https-dive/01.png" alt="HTTPS 설명하기"></a></figure><div class="media-content"><p class="date"><time datetime="2021-08-12T15:00:00.000Z">2021-08-13</time></p><p class="title"><a href="/posts/backend/https-dive/">HTTPS 설명하기</a></p><p class="categories"><a href="/categories/backend/">backend</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/posts/backend/nest-todo-api-demo/"><img src="https://nestjs.com/img/nest-og.png" alt="Nest + TypeORM TODO API 만들기"></a></figure><div class="media-content"><p class="date"><time datetime="2020-03-25T15:00:00.000Z">2020-03-26</time></p><p class="title"><a href="/posts/backend/nest-todo-api-demo/">Nest + TypeORM TODO API 만들기</a></p><p class="categories"><a href="/categories/backend/">backend</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/posts/backend/nestjs-quicklearn-04/"><img src="https://encrypted-tbn0.gstatic.com/images?q=tbn%3AANd9GcQrPO0DAItnewF8q-FXXT_sT8FP5cBUjdv36Ul4jIaW8oPstDwg" alt="NestJS 빠르게 배우기 04"></a></figure><div class="media-content"><p class="date"><time datetime="2020-03-24T15:00:00.000Z">2020-03-25</time></p><p class="title"><a href="/posts/backend/nestjs-quicklearn-04/">NestJS 빠르게 배우기 04</a></p><p class="categories"><a href="/categories/backend/">backend</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/posts/backend/nestjs-quicklearn-03/"><img src="https://encrypted-tbn0.gstatic.com/images?q=tbn%3AANd9GcQrPO0DAItnewF8q-FXXT_sT8FP5cBUjdv36Ul4jIaW8oPstDwg" alt="NestJS 빠르게 배우기 03"></a></figure><div class="media-content"><p class="date"><time datetime="2020-03-22T15:00:00.000Z">2020-03-23</time></p><p class="title"><a href="/posts/backend/nestjs-quicklearn-03/">NestJS 빠르게 배우기 03</a></p><p class="categories"><a href="/categories/backend/">backend</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/posts/backend/nestjs-quicklearn-02/"><img src="https://encrypted-tbn0.gstatic.com/images?q=tbn%3AANd9GcQrPO0DAItnewF8q-FXXT_sT8FP5cBUjdv36Ul4jIaW8oPstDwg" alt="NestJS 빠르게 배우기 02"></a></figure><div class="media-content"><p class="date"><time datetime="2020-03-20T15:00:00.000Z">2020-03-21</time></p><p class="title"><a href="/posts/backend/nestjs-quicklearn-02/">NestJS 빠르게 배우기 02</a></p><p class="categories"><a href="/categories/backend/">backend</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/posts/backend/nestjs-quicklearn-01/"><img src="https://encrypted-tbn0.gstatic.com/images?q=tbn%3AANd9GcQrPO0DAItnewF8q-FXXT_sT8FP5cBUjdv36Ul4jIaW8oPstDwg" alt="NestJS 빠르게 배우기 01"></a></figure><div class="media-content"><p class="date"><time datetime="2020-03-19T15:00:00.000Z">2020-03-20</time></p><p class="title"><a href="/posts/backend/nestjs-quicklearn-01/">NestJS 빠르게 배우기 01</a></p><p class="categories"><a href="/categories/backend/">backend</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/posts/backend/serverside-typescript-setting-01/"><img src="https://devblogs.microsoft.com/typescript/wp-content/uploads/sites/11/2018/08/typescriptfeature.png" alt="Monolithic 서버사이드 타입스크립트 세팅 01"></a></figure><div class="media-content"><p class="date"><time datetime="2020-03-10T15:00:00.000Z">2020-03-11</time></p><p class="title"><a href="/posts/backend/serverside-typescript-setting-01/">Monolithic 서버사이드 타입스크립트 세팅 01</a></p><p class="categories"><a href="/categories/backend/">backend</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/posts/serverless/serverless-vpc-deploy-demo/"><img src="/images/2020-03-05-serverless-vpc-deploy-demo/thumbnail.png" alt="Serverless + S3 + DyanamoDB VPC에 배포하고 외부와 연결하기"></a></figure><div class="media-content"><p class="date"><time datetime="2020-03-04T15:00:00.000Z">2020-03-05</time></p><p class="title"><a href="/posts/serverless/serverless-vpc-deploy-demo/">Serverless + S3 + DyanamoDB VPC에 배포하고 외부와 연결하기</a></p><p class="categories"><a href="/categories/serverless/">serverless</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/posts/serverless/serverless-cronjob-crawler-demo/"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOEAAADhCAMAAAAJbSJIAAAAolBMVEUAAAD+V1H/WVP/WlRoJiSmPzwGAADRVVL3X1lmLizcU1D/WFCaPjsAAQDPTUsAAAPCS0f/Xlf/XFo/Hx5hLCtpLC1UKSf/W1LVUEz/VlbPTkd0MTDGS0a9S0h7NS8jCwqONzXsXFUnFBJSIyGjQj6YPzxJHhs2GRg/GxqGODdeJSQeCwrsWVanREBBFhVJIBzcXVW9SkUXCwt9OTi4VVWpSkrtSDTvAAADZ0lEQVR4nO3bW1vaMBzH8TSdnGKNrTJlypSJYzo8b+//rS14ASQUmpaLJuz7uVL857G/J+kpIUIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA0cdavcm7VZ6bFsLKNKfnaUqAN03S3UXoq9Fq9Ft0LKSsapabisrVIjuNkN5UOTb+ty82HFY1MxehbS4E2HMuKY+05Da6KynhJIpU6aSVOiaqE8tppMPYIaDo5noTpd6dB79AS5jd2fT89tITWgZpLzlvVeRtbQnlrVWsx8QkYUUKV/7DuhuIur75TxJNQmT8NRKY7y+JMTL0GaSwJzV1tdO+UT5LDOg9V8dOufs69unDRNIqEqZw41ffS44ntM6AMJ+Guw1RPTvVASc8rTRLOc2m+9QWhSIs7u3iWmw995EUeTB/++rLD0Cme7Sp23JX+OwAAgIhkwn5xDlBWXRK/0DuhfaEMg/7RFufWIWZiuq1wi4fWIjmOU1mqeLTrbvKkvLCUkhfBvB9um8WYCL3qQ/PTrddc9+odP/x5mrHorFVpcVInYAwJ0759pfjtPckWS8JeZz2hFle1BmnwCc1Hp9bVviOu/SYRY0loBumVU+a1ahhNQqk2lraHqd96RSQJ1WLVMLMe2ryWtuNJmKTprVM1r3cahp5QjvKZXfSYey5XRJJQJQOn6Eke1nkolbtqOK/ZhWElLDm8/NmueSl8vgZluQhnde2+t6F4ra6p1m0lTpnOJut5JsvE4pOyut1aS+RldTPMms0qhT0FojdnIGrPSGShzGEAAIAy2rpV7/FoEs4tX6+zI2XmV91IW2G8rB1dpvfpiFBiPgxs1vyFFmeDpsZtJXI57/ju/IXnt55dUslw9j1ZEeTUuUS8NgoY1iyGlTB/sSdKZz6bnKJKOLf+pmuuGkaQUC4uD6tRqsVls4BhJlzsrkit/aKZuClqTrGFnXC0uSDz0exKGmjCRS++mYG5PkhPGwYMNWGSO6uG7zVXDQNPaM643rt9r6i5tB16wsTZa2ieScdNT8MwE0prQ+xnV84Tv31ckSRM1PqG2MWL02Mq1SElVIn7rHzUeJAGlfCju/ThvNL96e7jb0uB/O29dhTKG/CSs5aSZXtF1AHN0yw5S04BHiEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPg//AO9zTv9FO6XegAAAABJRU5ErkJggg==" alt="서버리스로 CronJob 만들기 (코로나 크롤러)"></a></figure><div class="media-content"><p class="date"><time datetime="2020-02-29T15:00:00.000Z">2020-03-01</time></p><p class="title"><a href="/posts/serverless/serverless-cronjob-crawler-demo/">서버리스로 CronJob 만들기 (코로나 크롤러)</a></p><p class="categories"><a href="/categories/serverless/">serverless</a></p></div></article></div></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/posts/logs/20200807/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">초기 스타트업 회고</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/posts/etc/refactoring-practice/"><span class="level-item">리팩토링 실습하기</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card" id="comments"><div class="card-content"><h3 class="title is-5">댓글</h3><div class="fb-comments" data-width="100%" data-href="https://changhoi.kim/posts/backend/go-lambda-try/" data-num-posts="5"></div><script>(function(d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) return;
            js = d.createElement(s); js.id = id;
            js.src = "//connect.facebook.net/ko/sdk.js#xfbml=1&version=v12.0";
            fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="https://avatars2.githubusercontent.com/u/34329147?s=400&amp;u=9d1b1dc88bc8ee5965f35b0160780264c3619eb6&amp;v=4" alt="Changhoi Kim"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Changhoi Kim</p><p class="is-size-6 is-block">Co-Founder of Bayesians</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Seoul, Korea</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">포스트</p><a href="/archives/"><p class="title">73</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">카테고리</p><a href="/categories/"><p class="title">13</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">태그</p><a href="/tags/"><p class="title">47</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://www.linkedin.com/in/changhoi/" target="_blank" rel="external nofollow noopener noreferrer">팔로우</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="external nofollow noopener noreferrer" title="LinkedIn" href="https://www.linkedin.com/in/changhoi/"><i class="fab fa-linkedin"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="external nofollow noopener noreferrer" title="Github" href="https://github.com/changhoi"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="external nofollow noopener noreferrer" title="Email" href="mailto:changhoi0522@gmail.com"><i class="fas fa-envelope-square"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="external nofollow noopener noreferrer" title="English" href="https://jayce.kim"><i class="fas fa-language"></i></a></div></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">카테고리</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/backend/"><span class="level-start"><span class="level-item">backend</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile" href="/categories/books/"><span class="level-start"><span class="level-item">books</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/database/"><span class="level-start"><span class="level-item">database</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile" href="/categories/docker/"><span class="level-start"><span class="level-item">docker</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/essay/"><span class="level-start"><span class="level-item">essay</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/etc/"><span class="level-start"><span class="level-item">etc</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile" href="/categories/go/"><span class="level-start"><span class="level-item">go</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/linux/"><span class="level-start"><span class="level-item">linux</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/logs/"><span class="level-start"><span class="level-item">logs</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/categories/network/"><span class="level-start"><span class="level-item">network</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/os/"><span class="level-start"><span class="level-item">os</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/rust/"><span class="level-start"><span class="level-item">rust</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/serverless/"><span class="level-start"><span class="level-item">serverless</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li></ul></div></div></div><div class="column-right-shadow is-hidden-widescreen is-sticky"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3 is-sticky"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">카탈로그</h3><ul class="menu-list"><li><a class="level is-mobile" href="#서비스-코드-작성하기"><span class="level-left"><span class="level-item">1</span><span class="level-item">서비스 코드 작성하기</span></span></a></li><li><a class="level is-mobile" href="#람다에-배포하기"><span class="level-left"><span class="level-item">2</span><span class="level-item">람다에 배포하기</span></span></a></li><li><a class="level is-mobile" href="#발생한-문제"><span class="level-left"><span class="level-item">3</span><span class="level-item">발생한 문제</span></span></a></li><li><a class="level is-mobile" href="#결론"><span class="level-left"><span class="level-item">4</span><span class="level-item">결론</span></span></a></li><li><a class="level is-mobile" href="#후기"><span class="level-left"><span class="level-item">5</span><span class="level-item">후기</span></span></a></li><li><a class="level is-mobile" href="#Reference"><span class="level-left"><span class="level-item">6</span><span class="level-item">Reference</span></span></a></li></ul></div></div><script src="/js/toc.js" defer></script></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.jpg" alt="Changhoi Kim" height="28"></a><p class="is-size-7"><span>&copy; 2025 changhoi</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="external nofollow noopener noreferrer">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="external nofollow noopener noreferrer">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="external nofollow noopener noreferrer" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="external nofollow noopener noreferrer" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("ko");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script data-pjax src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="맨 위로" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script data-pjax src="/js/back_to_top.js" defer></script><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><div id="outdated"><h6>Your browser is out-of-date!</h6><p>Update your browser to view this website correctly.&amp;npsb;<a id="btnUpdateBrowser" target="_blank" rel="external nofollow noopener noreferrer" href="http://outdatedbrowser.com/">Update my browser now </a></p><p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">×</a></p></div><script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script><script>window.addEventListener("load", function () {
            outdatedBrowser({
                bgColor: '#f25648',
                color: '#ffffff',
                lowerThan: 'object-fit' // display on IE11 or below
            });
        });</script><!--!--><script data-pjax src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="입력 하세요..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script data-pjax src="/js/insight.js" defer></script><script data-pjax>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"입력 하세요...","untitled":"(제목 없음)","posts":"포스트","pages":"페이지","categories":"카테고리","tags":"태그"});
        });</script></body></html>