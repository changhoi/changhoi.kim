<!doctype html>
<html lang="ko"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>MongoDB 모델링 - Changhoi Kim</title><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="white"><meta name="application-name" content="Changhoi Kim"><meta name="msapplication-TileImage" content="/img/favicon.ico"><meta name="msapplication-TileColor" content="white"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Changhoi Kim"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="최근에 시험도 준비하고, 일도 바빠서 쉽게 글을 남기기 힘들었는데, 쓸 내용들은 차곡차곡 쌓아두긴 했었다. 우선 정리와 복습도 할 겸, 최근 서비스에서 사용하고 있는 MongoDB 모델링 하는 걸 공부한 내용을 정리했다. 이 내용은 공식 문서를 보고 번역하고 재배열한 내용이다."><meta property="og:type" content="blog"><meta property="og:title" content="MongoDB 모델링"><meta property="og:url" content="https://changhoi.kim/posts/database/mongodb-modeling/"><meta property="og:site_name" content="Changhoi Kim"><meta property="og:description" content="최근에 시험도 준비하고, 일도 바빠서 쉽게 글을 남기기 힘들었는데, 쓸 내용들은 차곡차곡 쌓아두긴 했었다. 우선 정리와 복습도 할 겸, 최근 서비스에서 사용하고 있는 MongoDB 모델링 하는 걸 공부한 내용을 정리했다. 이 내용은 공식 문서를 보고 번역하고 재배열한 내용이다."><meta property="og:locale" content="ko_KR"><meta property="og:image" content="https://cdn.iconscout.com/icon/free/png-512/mongodb-226029.png"><meta property="article:published_time" content="2021-05-07T15:00:00.000Z"><meta property="article:modified_time" content="2021-05-07T15:00:00.000Z"><meta property="article:author" content="changhoi"><meta property="article:tag" content="architecture"><meta property="article:tag" content="mongodb"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://cdn.iconscout.com/icon/free/png-512/mongodb-226029.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://changhoi.kim/posts/database/mongodb-modeling/"},"headline":"MongoDB 모델링","image":["https://cdn.iconscout.com/icon/free/png-512/mongodb-226029.png"],"datePublished":"2021-05-07T15:00:00.000Z","dateModified":"2021-05-07T15:00:00.000Z","author":{"@type":"Person","name":"changhoi"},"publisher":{"@type":"Organization","name":"Changhoi Kim","logo":{"@type":"ImageObject","url":"https://changhoi.kim/img/logo.jpg"}},"description":"최근에 시험도 준비하고, 일도 바빠서 쉽게 글을 남기기 힘들었는데, 쓸 내용들은 차곡차곡 쌓아두긴 했었다. 우선 정리와 복습도 할 겸, 최근 서비스에서 사용하고 있는 MongoDB 모델링 하는 걸 공부한 내용을 정리했다. 이 내용은 공식 문서를 보고 번역하고 재배열한 내용이다."}</script><link rel="canonical" href="https://changhoi.kim/posts/database/mongodb-modeling/"><link rel="alternate" href="/rss2.xml" title="Changhoi Kim" type="application/atom+xml"><link rel="icon" href="/img/favicon.ico"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link data-pjax rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link data-pjax rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=G-QBSLW6WTZW" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'G-QBSLW6WTZW');</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css"><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.jpg" alt="Changhoi Kim" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item is-hidden-tablet catalogue" title="카탈로그" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="검색" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><div class="card-image"><span class="image is-7by3"><img class="fill" src="https://cdn.iconscout.com/icon/free/png-512/mongodb-226029.png" alt="MongoDB 모델링"></span></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time datetime="2021-05-07T15:00:00.000Z" title="2021. 5. 7. 오전 8:00:00">2021-05-08</time>&nbsp;게시 됨</span><span class="level-item"><time datetime="2021-05-07T15:00:00.000Z" title="2021. 5. 7. 오전 8:00:00">2021-05-08</time>&nbsp;업데이트 됨</span><span class="level-item"><a class="link-muted" href="/categories/database/">database</a></span><span class="level-item">27분안에 읽기 (약 4013 단어)</span></div></div><h1 class="title is-3 is-size-4-mobile">MongoDB 모델링</h1><div class="content"><p>최근에 시험도 준비하고, 일도 바빠서 쉽게 글을 남기기 힘들었는데, 쓸 내용들은 차곡차곡 쌓아두긴 했었다. 우선 정리와 복습도 할 겸, 최근 서비스에서 사용하고 있는 MongoDB 모델링 하는 걸 공부한 내용을 정리했다. 이 내용은 공식 문서를 보고 번역하고 재배열한 내용이다.</p>
<span id="more"></span>

<h1 id="Flexible-Schema"><a href="#Flexible-Schema" class="headerlink" title="Flexible Schema"></a>Flexible Schema</h1><p>MongoDB는 어떤 데이터를 집어 넣을지 미리 결정되어 있는 “테이블”과 다르게, 스키마에 대해 자유로운 <code>document</code>(다큐멘트)가 모이는, <code>collection</code>(콜렉션)으로 구성된다.</p>
<ul>
<li>하나의 콜랙션에 있는 다큐멘트들은 같은 필드나, 같은 데이터 타입을 가질 필요가 없다.</li>
<li>필드를 더하거나, 필드의 데이터 타입을 바꾸는 등, 다큐멘트의 구조를 바꾸려면, 그 특정 다큐멘트의 구조를 바꿔주면 된다.</li>
</ul>
<blockquote>
<p>실제로는 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://docs.mongodb.com/manual/core/schema-validation/"><code>document</code> rules</a>를 강제해 하나의 콜렉션이 유사한 구조를 공유하도록 강제한다.</p>
</blockquote>
<h1 id="Document-Structure"><a href="#Document-Structure" class="headerlink" title="Document Structure"></a>Document Structure</h1><p>“MongoDB란 무엇일까?”에 대한 내용을 다루는 글이 아니므로, 스키마의 특징, 데이터 타입 등은 건너 뛰고, 다큐멘트 구조에 대해서 한 번 살펴보자. MongoDB 앱의 데이터 모델을 설계할 때 중요한 사항은 다큐멘트의 구조와 애플리케이션이 데이터 관계를 어떻게 나타내는지이다. MongoDB는 관련 데이터를 하나의 다큐멘트 안에 포함하도록 한다. 두 가지 방법으로 관계에 대한 표현을 할 수 있는데, 하나의 다큐멘트 안에 포함시키는 <code>Embedded</code> 방식, 참조하도록 하는 <code>Reference</code> 방식이다.</p>
<h2 id="Embedded-Data"><a href="#Embedded-Data" class="headerlink" title="Embedded Data"></a>Embedded Data</h2><p><code>Embedded Data</code> 모델에서는 유관한 데이터를 하나의 다큐멘트에 담는다. 이러한 스키마는 일반적으로 “비정규화” 모델로 알려져있다.</p>
<p><img src="https://docs.mongodb.com/manual/_images/data-model-denormalized.bakedsvg.svg"></p>
<p>임베디드된 데이터 모델들은 애플리케이션이 유관한 정보 조각들을 하나의 데이터베이스 레코드에 저장할 수 있게 한다. 결과적으로 애플리케이션은 더 적은 쿼리와 업데이트를 가지고 필요한 작업을 수행할 수 있게 된다.</p>
<h3 id="엔티티-사이에-포함-관계가-있는-경우-1-1-관계"><a href="#엔티티-사이에-포함-관계가-있는-경우-1-1-관계" class="headerlink" title="엔티티 사이에 포함 관계가 있는 경우 (1:1 관계)"></a>엔티티 사이에 포함 관계가 있는 경우 (1:1 관계)</h3><ol>
<li><p><strong>Embedded Document Pattern</strong><br>“고객”과 주소 관계를 이어주는 예시를 생각해보자. <code>address</code>는 <code>patron</code>에게 종속되는 관계이다. 정규화 되어있다면, 아래와 같은 모습을 보인다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// patron document</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">_id</span>: <span class="string">&quot;joe&quot;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;Joe Bookreader&quot;</span></span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> <span class="comment">// address document</span></span><br><span class="line"> &#123;</span><br><span class="line">     <span class="attr">patron_id</span>: <span class="string">&quot;joe&quot;</span>,</span><br><span class="line">     <span class="attr">street</span>: <span class="string">&quot;123 Fake Street&quot;</span>,</span><br><span class="line">     <span class="attr">city</span>: <span class="string">&quot;Faketon&quot;</span>,</span><br><span class="line">     <span class="attr">state</span>: <span class="string">&quot;MA&quot;</span>,</span><br><span class="line">     <span class="attr">zip</span>: <span class="string">&quot;12345&quot;</span></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p> 이 경우, 만약 <code>address</code>의 데이터가 자주 이름 정보와 함께 검색되는 편이라면, 레퍼런스를 참조하기 위해 여러 쿼리를 실행하게 된다. 해결 방안은 <code>address</code> 데이터를 <code>patron</code> 데이터에 임베드 하는 것이다. 임베디드 데이터 모델은 애플리케이션에서 완전한 <code>patron</code> 정보를 가져오기 위해 한 번의 쿼리만 사용할 수 있다.</p>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">_id</span>: <span class="string">&quot;joe&quot;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;Joe Bookreader&quot;</span>,</span><br><span class="line">    <span class="attr">address</span>: &#123;</span><br><span class="line">        <span class="attr">street</span>: <span class="string">&quot;123 Fake Street&quot;</span>,</span><br><span class="line">        <span class="attr">city</span>: <span class="string">&quot;Faketon&quot;</span>,</span><br><span class="line">        <span class="attr">state</span>: <span class="string">&quot;MA&quot;</span>,</span><br><span class="line">        <span class="attr">zip</span>: <span class="string">&quot;12345&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Subset Pattern</strong><br> Embedded Document Pattern은 애플리케이션이 사용할 때 별로 필요 없는 정보를 포함한 큰 다큐멘트를 만들 수 있다는 문제가 있다. 이런 불필요한 데이터는 추가적인 로드를 야기하고, 당연히 읽기 퍼포먼스를 떨어뜨릴 수 있다. 대신, 자주 접근하는 정보를 모아 Subset 패턴틀 사용할 수 있다. 영화 정보를 보여주는 애플리케이션을 생각해보자. 데이터베이스는 아래와 같은 <code>movie</code> 스키마를 가지고 있다.</p>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">_id</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&quot;The Arrival of a Train&quot;</span>,</span><br><span class="line">    <span class="attr">year</span>: <span class="number">1896</span>,</span><br><span class="line">    <span class="attr">runtime</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">released</span>: <span class="title class_">ISODate</span>(<span class="string">&quot;01-25-1896&quot;</span>),</span><br><span class="line">    <span class="attr">poster</span>: <span class="string">&quot;http://ia.media-imdb.com/images/M/MV5BMjEyNDk5MDYzOV5BMl5BanBnXkFtZTgwNjIxMTEwMzE@._V1_SX300.jpg&quot;</span>,</span><br><span class="line">    <span class="attr">plot</span>: <span class="string">&quot;A group of people are standing in a straight line along the platform of a railway station, waiting for a train, which is seen coming at some distance. When the train stops at the platform, ...&quot;</span>,</span><br><span class="line">    <span class="attr">fullplot</span>: <span class="string">&quot;A group of people are standing in a straight line along the platform of a railway station, waiting for a train, which is seen coming at some distance. When the train stops at the platform, the line dissolves. The doors of the railway-cars open, and people on the platform help passengers to get off.&quot;</span>,</span><br><span class="line">    <span class="attr">lastupdated</span>: <span class="title class_">ISODate</span>(<span class="string">&quot;2015-08-15T10:06:53&quot;</span>),</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&quot;movie&quot;</span>,</span><br><span class="line">    <span class="attr">directors</span>: [ <span class="string">&quot;Auguste Lumière&quot;</span>, <span class="string">&quot;Louis Lumière&quot;</span> ],</span><br><span class="line">    <span class="attr">imdb</span>: &#123;</span><br><span class="line">        <span class="attr">rating</span>: <span class="number">7.3</span>,</span><br><span class="line">        <span class="attr">votes</span>: <span class="number">5043</span>,</span><br><span class="line">        <span class="attr">id</span>: <span class="number">12</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">countries</span>: [ <span class="string">&quot;France&quot;</span> ],</span><br><span class="line">    <span class="attr">genres</span>: [ <span class="string">&quot;Documentary&quot;</span>, <span class="string">&quot;Short&quot;</span> ],</span><br><span class="line">    <span class="attr">tomatoes</span>: &#123;</span><br><span class="line">        <span class="attr">viewer</span>: &#123;</span><br><span class="line">            <span class="attr">rating</span>: <span class="number">3.7</span>,</span><br><span class="line">            <span class="attr">numReviews</span>: <span class="number">59</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">lastUpdated</span>: <span class="title class_">ISODate</span>(<span class="string">&quot;2020-01-09T00:02:53&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> movie 콜렉션은 애플리케이션이 간단한 영화의 Overview를 보여줄 때 사용하지 않는 정보들을 가지고 있다. 예를 들어서, <code>fullPlot</code>, <code>rating</code> 관련된 정보들이 그렇다고 가정하자. 이 경우, 모든 영화 데이터를 하나의 콜렉션에 저장하기 보다는 두 콜렉션으로 나눌 수 있다.</p>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 영화 기본 정보를 담고 있는 movie 콜렉션. 애플리케이션이 기본적으로 불러오게 되는 데이터</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">_id</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&quot;The Arrival of a Train&quot;</span>,</span><br><span class="line">    <span class="attr">year</span>: <span class="number">1896</span>,</span><br><span class="line">    <span class="attr">runtime</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">released</span>: <span class="title class_">ISODate</span>(<span class="string">&quot;1896-01-25&quot;</span>),</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&quot;movie&quot;</span>,</span><br><span class="line">    <span class="attr">directors</span>: [ <span class="string">&quot;Auguste Lumière&quot;</span>, <span class="string">&quot;Louis Lumière&quot;</span> ],</span><br><span class="line">    <span class="attr">countries</span>: [ <span class="string">&quot;France&quot;</span> ],</span><br><span class="line">    <span class="attr">genres</span>: [ <span class="string">&quot;Documentary&quot;</span>, <span class="string">&quot;Short&quot;</span> ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// movie_detail 콜렉션은 부가적이고, 덜 접근이 되는 정보를 담는다.</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">_id</span>: <span class="number">156</span>,</span><br><span class="line">    <span class="attr">movie_id</span>: <span class="number">1</span>, <span class="comment">// reference to the movie collection</span></span><br><span class="line">    <span class="attr">poster</span>: <span class="string">&quot;http://ia.media-imdb.com/images/M/MV5BMjEyNDk5MDYzOV5BMl5BanBnXkFtZTgwNjIxMTEwMzE@._V1_SX300.jpg&quot;</span>,</span><br><span class="line">    <span class="attr">plot</span>: <span class="string">&quot;A group of people are standing in a straight line along the platform of a railway station, waiting for a train, which is seen coming at some distance. When the train stops at the platform, ...&quot;</span>,</span><br><span class="line">    <span class="attr">fullplot</span>: <span class="string">&quot;A group of people are standing in a straight line along the platform of a railway station, waiting for a train, which is seen coming at some distance. When the train stops at the platform, the line dissolves. The doors of the railway-cars open, and people on the platform help passengers to get off.&quot;</span>,</span><br><span class="line">    <span class="attr">lastupdated</span>: <span class="title class_">ISODate</span>(<span class="string">&quot;2015-08-15T10:06:53&quot;</span>),</span><br><span class="line">    <span class="attr">imdb</span>: &#123;</span><br><span class="line">      <span class="attr">rating</span>: <span class="number">7.3</span>,</span><br><span class="line">      <span class="attr">votes</span>: <span class="number">5043</span>,</span><br><span class="line">      <span class="attr">id</span>: <span class="number">12</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">tomatoes</span>: &#123;</span><br><span class="line">        <span class="attr">viewer</span>: &#123;</span><br><span class="line">            <span class="attr">rating</span>: <span class="number">3.7</span>,</span><br><span class="line">            <span class="attr">numReviews</span>: <span class="number">59</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">lastUpdated</span>: <span class="title class_">ISODate</span>(<span class="string">&quot;2020-01-29T00:02:53&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> 이 방법은 더 적은 데이터를 일반적인 요청 상황에서 불러오기 때문에, 읽기 퍼포먼스를 향상시킨다. 애플리케이션에서 필요하다면, <code>movie collection</code>의 데이터를 불러올 수 있게 구성한다.</p>
<blockquote>
<p>이 방식에서는 <strong>Trade-off</strong>가 존재한다. 자주 접근되는 데이터를 담은 더 작은 다큐멘트들은 Working set의 전체적인 크기를 줄여주고, 읽기 퍼포먼스 향상, 그리고 애플리케이션 메모리를 절약해준다. 하지만, 애플리케이션이 데이터를 읽어오는 방식에 대한 이해도가 필요하다. 만약 데이터를 여러 콜렉션으로 부적절하게 나눈다면, 애플리케이션은 필요한 데이터를 가져오기 위해 <code>JOIN</code>을 수행하게 될 수 있다. 게다가, 데이터를 많은 조각으로 나누면, 어떤 데이터가 어떤 콜렉션에 저장되어 있는지 추적하기 어려워지기 때문에 필요한 데이터베이스 유지보수가 증가할 수 있다.</p>
</blockquote>
</li>
</ol>
<h3 id="엔티티-사이에-1-N-관계가-있고-N이-1-부분에-항상-보여야-할-때"><a href="#엔티티-사이에-1-N-관계가-있고-N이-1-부분에-항상-보여야-할-때" class="headerlink" title="엔티티 사이에 1:N 관계가 있고, N이 1 부분에 항상 보여야 할 때"></a>엔티티 사이에 1:N 관계가 있고, N이 1 부분에 항상 보여야 할 때</h3><p>이 경우에도 위와 같이, <code>Embedded Document Pattern</code>과, <code>Subset Pattern</code>이 있다. 구현 방식 역시 유사하다.</p>
<ol>
<li><p><strong>Embedded Document Pattern</strong><br>아래 예시에서는 고객과 여러 주소 관계를 표현하고 있다. 많은 데이터 엔티티들을 다른 하나의 컨텍스트 안에서 봐야 할 때, 임베딩 하는 것이 레퍼런스 하는 경우보다 나은 경우를 설명한다 (안 그런 경우도 있다). <code>patron</code>과 <code>address</code> 사이의 1:N 관계에서, <code>patron</code>은 복수의 <code>address</code>를 가지고 있다. 정규화 되어있는 경우, <code>address</code> 다큐멘트는 <code>patron</code> 다큐멘트를 참조하고 있다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 정규화 된 데이터</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">_id</span>: <span class="string">&quot;joe&quot;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;Joe Bookreader&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// address documents</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">patron_id</span>: <span class="string">&quot;joe&quot;</span>, <span class="comment">// reference to patron document</span></span><br><span class="line">    <span class="attr">street</span>: <span class="string">&quot;123 Fake Street&quot;</span>,</span><br><span class="line">    <span class="attr">city</span>: <span class="string">&quot;Faketon&quot;</span>,</span><br><span class="line">    <span class="attr">state</span>: <span class="string">&quot;MA&quot;</span>,</span><br><span class="line">    <span class="attr">zip</span>: <span class="string">&quot;12345&quot;</span></span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> &#123;</span><br><span class="line">     <span class="attr">patron_id</span>: <span class="string">&quot;joe&quot;</span>,</span><br><span class="line">     <span class="attr">street</span>: <span class="string">&quot;1 Some Other Street&quot;</span>,</span><br><span class="line">     <span class="attr">city</span>: <span class="string">&quot;Boston&quot;</span>,</span><br><span class="line">     <span class="attr">state</span>: <span class="string">&quot;MA&quot;</span>,</span><br><span class="line">     <span class="attr">zip</span>: <span class="string">&quot;12345&quot;</span></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>만약 애플리케이션이 address 데이터를 이름 정보와 함께 조회하는 경우가 많다면, 참조된 데이터를 가져오기 위해 여러번의 쿼리를 수행해야 한다. 더 최적화된 스키마는 address 데이터를 patron에 임베드 시키는 것이다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">_id</span>: <span class="string">&quot;joe&quot;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;Joe Bookreader&quot;</span>,</span><br><span class="line">    <span class="attr">addresses</span>: [</span><br><span class="line">         &#123;</span><br><span class="line">             <span class="attr">street</span>: <span class="string">&quot;123 Fake Street&quot;</span>,</span><br><span class="line">             <span class="attr">city</span>: <span class="string">&quot;Faketon&quot;</span>,</span><br><span class="line">             <span class="attr">state</span>: <span class="string">&quot;MA&quot;</span>,</span><br><span class="line">             <span class="attr">zip</span>: <span class="string">&quot;12345&quot;</span></span><br><span class="line">         &#125;,</span><br><span class="line">         &#123;</span><br><span class="line">             <span class="attr">street</span>: <span class="string">&quot;1 Some Other Street&quot;</span>,</span><br><span class="line">             <span class="attr">city</span>: <span class="string">&quot;Boston&quot;</span>,</span><br><span class="line">             <span class="attr">state</span>: <span class="string">&quot;MA&quot;</span>,</span><br><span class="line">             <span class="attr">zip</span>: <span class="string">&quot;12345&quot;</span></span><br><span class="line">         &#125;</span><br><span class="line">     ]</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Subset Pattern</strong><br>Embbed Document Pattern의 문제는 거대한 다큐멘트를 만들 수 있다는 점이다. 이런 경우, Subset Pattern을 사용해서 오직 애플리케이션이 요구하는 데이터에만 접근하도록 수 있다. 프로덕트에 리뷰를 달 수 있는 커머스 사이트를 예로 들어보자.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   <span class="attr">_id</span>: <span class="number">1</span>,</span><br><span class="line">   <span class="attr">name</span>: <span class="string">&quot;Super Widget&quot;</span>,</span><br><span class="line">   <span class="attr">description</span>: <span class="string">&quot;This is the most useful item in your toolbox.&quot;</span>,</span><br><span class="line">   <span class="attr">price</span>: &#123; <span class="attr">value</span>: <span class="title class_">NumberDecimal</span>(<span class="string">&quot;119.99&quot;</span>), <span class="attr">currency</span>: <span class="string">&quot;USD&quot;</span> &#125;,</span><br><span class="line">   <span class="attr">reviews</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">review_id</span>: <span class="number">786</span>,</span><br><span class="line">            <span class="attr">review_author</span>: <span class="string">&quot;Kristina&quot;</span>,</span><br><span class="line">            <span class="attr">review_text</span>: <span class="string">&quot;This is indeed an amazing widget.&quot;</span>,</span><br><span class="line">            <span class="attr">published_date</span>: <span class="title class_">ISODate</span>(<span class="string">&quot;2019-02-18&quot;</span>)</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">review_id</span>: <span class="number">785</span>,</span><br><span class="line">            <span class="attr">review_author</span>: <span class="string">&quot;Trina&quot;</span>,</span><br><span class="line">            <span class="attr">review_text</span>: <span class="string">&quot;Nice product. Slow shipping.&quot;</span>,</span><br><span class="line">            <span class="attr">published_date</span>: <span class="title class_">ISODate</span>(<span class="string">&quot;2019-02-17&quot;</span>)</span><br><span class="line">        &#125;,</span><br><span class="line">        ...</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">review_id</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="attr">review_author</span>: <span class="string">&quot;Hans&quot;</span>,</span><br><span class="line">            <span class="attr">review_text</span>: <span class="string">&quot;Meh, it&#x27;s okay.&quot;</span>,</span><br><span class="line">            <span class="attr">published_date</span>: <span class="title class_">ISODate</span>(<span class="string">&quot;2017-12-06&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>리뷰는 최신순으로 정렬되어있다. 프로덕트 페이지에 들어가면, 애플리케이션은 10개의 가장 최근 리뷰를 보여준다. 이 경우 모든 리뷰를 하나의 콜렉션에 담을 필요는 없다. 그 대신, 콜렉션을 두 개로 나눌 수 있다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 10개의 최신 리뷰와 함게, 각 프로덕트 정보를 저장하느 product 콜렉션</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">_id</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;Super Widget&quot;</span>,</span><br><span class="line">    <span class="attr">description</span>: <span class="string">&quot;This is the most useful item in your toolbox.&quot;</span>,</span><br><span class="line">    <span class="attr">price</span>: &#123; <span class="attr">value</span>: <span class="title class_">NumberDecimal</span>(<span class="string">&quot;119.99&quot;</span>), <span class="attr">currency</span>: <span class="string">&quot;USD&quot;</span> &#125;,</span><br><span class="line">    <span class="attr">reviews</span>: [</span><br><span class="line">         &#123;</span><br><span class="line">             <span class="attr">review_id</span>: <span class="number">786</span>,</span><br><span class="line">             <span class="attr">review_author</span>: <span class="string">&quot;Kristina&quot;</span>,</span><br><span class="line">             <span class="attr">review_text</span>: <span class="string">&quot;This is indeed an amazing widget.&quot;</span>,</span><br><span class="line">             <span class="attr">published_date</span>: <span class="title class_">ISODate</span>(<span class="string">&quot;2019-02-18&quot;</span>)</span><br><span class="line">         &#125;</span><br><span class="line">         ...</span><br><span class="line">         &#123;</span><br><span class="line">             <span class="attr">review_id</span>: <span class="number">776</span>,</span><br><span class="line">             <span class="attr">review_author</span>: <span class="string">&quot;Pablo&quot;</span>,</span><br><span class="line">             <span class="attr">review_text</span>: <span class="string">&quot;Amazing!&quot;</span>,</span><br><span class="line">             <span class="attr">published_date</span>: <span class="title class_">ISODate</span>(<span class="string">&quot;2019-02-16&quot;</span>)</span><br><span class="line">         &#125;</span><br><span class="line">     ]</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 모든 리뷰들을 저장하는 review 콜렉션, 각 리뷰들은 product를 참조한다.</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">review_id</span>: <span class="number">786</span>,</span><br><span class="line">    <span class="attr">product_id</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">review_author</span>: <span class="string">&quot;Kristina&quot;</span>,</span><br><span class="line">    <span class="attr">review_text</span>: <span class="string">&quot;This is indeed an amazing widget.&quot;</span>,</span><br><span class="line">    <span class="attr">published_date</span>: <span class="title class_">ISODate</span>(<span class="string">&quot;2019-02-18&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">review_id</span>: <span class="number">785</span>,</span><br><span class="line">    <span class="attr">product_id</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">review_author</span>: <span class="string">&quot;Trina&quot;</span>,</span><br><span class="line">    <span class="attr">review_text</span>: <span class="string">&quot;Nice product. Slow shipping.&quot;</span>,</span><br><span class="line">    <span class="attr">published_date</span>: <span class="title class_">ISODate</span>(<span class="string">&quot;2019-02-17&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">review_id</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">product_id</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">review_author</span>: <span class="string">&quot;Hans&quot;</span>,</span><br><span class="line">    <span class="attr">review_text</span>: <span class="string">&quot;Meh, it&#x27;s okay.&quot;</span>,</span><br><span class="line">    <span class="attr">published_date</span>: <span class="title class_">ISODate</span>(<span class="string">&quot;2017-12-06&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>최근 10개의 리뷰만 product 콜랙션에 담아두는 것을 통해서, 필요한 부분만 production 콜랙션에 요청을 했을 때 받을 수 있다. 만약 유저가 추가적인 리뷰를 보고 싶어 하면, 애플리케이션은 review 콜랙션에서 이를 가져오면 된다.</p>
<blockquote>
<p>마찬가지로, 이 경우의 Subset Pattern에서도 Trade off가 존재한다. 더 자주 접근 되는 데이터만 담고 있는 작은 다큐멘트를 쓰는 것은 working set의 전체 사이즈를 줄여준다. 이러한 더 작은 다큐멘트들은 결과적으로 읽기 퍼포먼스를 향상시킨다. 하지만, Subset 패턴은 데이터 중복으로 이어진다. 예를 들어서, review는 product와 review 콜랙션 모두에게 있다. 추가적인 단계들이 각 콜랙션 사이에 동일성을 유지하기 위해 필요하다. 또한 애플리케이션에서 제한된 Subset 수를 유지하기 위한 추가적인 로직이 필요하다. (최근 리뷰가 들어오면, 마지막 리뷰를 빼주는 등)</p>
</blockquote>
</li>
</ol>
<hr>
<p>일반적으로 임베딩 하는 것이 읽기 작업에서 더 나은 퍼포먼스를 보여준다. 임베디드 데이터 모델은 연관된 데이터를 업데이트 하는 것을 하나의 쓰기 작업으로 가능하게 만든다.</p>
<h1 id="Normalized-Data-Model-Reference"><a href="#Normalized-Data-Model-Reference" class="headerlink" title="Normalized Data Model (Reference)"></a>Normalized Data Model (Reference)</h1><p>정규화된 데이터 모델은 관계를 <code>reference</code>를 통해 표현한다.</p>
<p><img src="https://docs.mongodb.com/manual/_images/data-model-normalized.bakedsvg.svg"></p>
<p>일반적으로, 정규화된 데이터 모델은 다음과 같은 상황에서 사용한다.</p>
<ul>
<li>1:N 관계에서 임베딩 하는 것이 데이터 중복을 일으키고, 충분한 읽기 퍼포먼스를 제공하지 못하는 경우</li>
<li>더 복잡한 N:M 관계를 표현해야 할 때</li>
<li>큰 계층적 데이터 셋을 표현해야 할 때</li>
</ul>
<p>문서에서는 N:M에 대한 부분을 직접 언급하는 페이지는 없었고, 1:N 관계와, 트리구조라는 형태로 분류되어있다.</p>
<h2 id="1-N-관계"><a href="#1-N-관계" class="headerlink" title="1:N 관계"></a>1:N 관계</h2><p><code>publisher</code>와 <code>book</code>의 관계를 연결하는 예시를 살펴보자. 아래 예시의 경우는 <code>publisher</code> 정보의 반복을 피하기 위해서는 임베딩 하는 것보다 참조를 사용하는 것이 더 좋다는 내용이다. 임베딩 된 경우를 확인해보면 아래와 같다. <code>publisher</code>에 대한 정보가 <code>book</code> 다큐멘트 안에서 중복되고 있다는 것을 알 수 있다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   <span class="attr">title</span>: <span class="string">&quot;MongoDB: The Definitive Guide&quot;</span>,</span><br><span class="line">   <span class="attr">author</span>: [ <span class="string">&quot;Kristina Chodorow&quot;</span>, <span class="string">&quot;Mike Dirolf&quot;</span> ],</span><br><span class="line">   <span class="attr">published_date</span>: <span class="title class_">ISODate</span>(<span class="string">&quot;2010-09-24&quot;</span>),</span><br><span class="line">   <span class="attr">pages</span>: <span class="number">216</span>,</span><br><span class="line">   <span class="attr">language</span>: <span class="string">&quot;English&quot;</span>,</span><br><span class="line">   <span class="attr">publisher</span>: &#123; </span><br><span class="line">     <span class="attr">name</span>: <span class="string">&quot;O&#x27;Reilly Media&quot;</span>,</span><br><span class="line">  <span class="attr">founded</span>: <span class="number">1980</span>,</span><br><span class="line">  <span class="attr">location</span>: <span class="string">&quot;CA&quot;</span> </span><br><span class="line"> &#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">   <span class="attr">title</span>: <span class="string">&quot;50 Tips and Tricks for MongoDB Developer&quot;</span>,</span><br><span class="line">   <span class="attr">author</span>: <span class="string">&quot;Kristina Chodorow&quot;</span>,</span><br><span class="line">   <span class="attr">published_date</span>: <span class="title class_">ISODate</span>(<span class="string">&quot;2011-05-06&quot;</span>),</span><br><span class="line">   <span class="attr">pages</span>: <span class="number">68</span>,</span><br><span class="line">   <span class="attr">language</span>: <span class="string">&quot;English&quot;</span>, </span><br><span class="line">   <span class="attr">publisher</span>: &#123; </span><br><span class="line">     <span class="attr">name</span>: <span class="string">&quot;O&#x27;Reilly Media&quot;</span>,</span><br><span class="line">  <span class="attr">founded</span>: <span class="number">1980</span>, </span><br><span class="line">  <span class="attr">location</span>: <span class="string">&quot;CA&quot;</span> </span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>이런 중복을 피하기 위해서 <code>reference</code>를 사용한다. 참조를 사용할 때 관계들의 증가에 따라 참조를 저장할 위치를 결정한다. 위 예시 상황을 말 해보자면, <code>publisher</code> 당 <code>book</code>의 수가 조금만 증가 하는 경우, <code>book</code> 참조를 <code>publisher</code> 다큐멘트 안에 넣는것이 좋다. 그렇지 않다면, 즉, <code>publisher</code> 당 <code>book</code>의 수가 제한 없이 커진다면, 이 데이터 모델은 아래 예시처럼 변경 가능하고 증가 하는 배열 형태를 가져야 한다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   <span class="attr">name</span>: <span class="string">&quot;O&#x27;Reilly Media&quot;</span>,</span><br><span class="line">   <span class="attr">founded</span>: <span class="number">1980</span>,</span><br><span class="line">   <span class="attr">location</span>: <span class="string">&quot;CA&quot;</span>,</span><br><span class="line">   <span class="attr">books</span>: [<span class="number">123456789</span>, <span class="number">234567890</span>, ...] </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">_id</span>: <span class="number">123456789</span>,</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&quot;MongoDB: The Definitive Guide&quot;</span>,</span><br><span class="line">    <span class="attr">author</span>: [ <span class="string">&quot;Kristina Chodorow&quot;</span>, <span class="string">&quot;Mike Dirolf&quot;</span> ],</span><br><span class="line">    <span class="attr">published_date</span>: <span class="title class_">ISODate</span>(<span class="string">&quot;2010-09-24&quot;</span>),</span><br><span class="line">    <span class="attr">pages</span>: <span class="number">216</span>,</span><br><span class="line">    <span class="attr">language</span>: <span class="string">&quot;English&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">   <span class="attr">_id</span>: <span class="number">234567890</span>,</span><br><span class="line">   <span class="attr">title</span>: <span class="string">&quot;50 Tips and Tricks for MongoDB Developer&quot;</span>,</span><br><span class="line">   <span class="attr">author</span>: <span class="string">&quot;Kristina Chodorow&quot;</span>,</span><br><span class="line">   <span class="attr">published_date</span>: <span class="title class_">ISODate</span>(<span class="string">&quot;2011-05-06&quot;</span>),</span><br><span class="line">   <span class="attr">pages</span>: <span class="number">68</span>,</span><br><span class="line">   <span class="attr">language</span>: <span class="string">&quot;English&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="트리-구조"><a href="#트리-구조" class="headerlink" title="트리 구조"></a>트리 구조</h2><p><img src="https://docs.mongodb.com/manual/_images/data-model-tree.bakedsvg.svg"></p>
<h3 id="Parent-References"><a href="#Parent-References" class="headerlink" title="Parent References"></a>Parent References</h3><p><em>Parent References</em> 패턴은 각 트리 노드를 다큐멘트에 저장한다. 트리 노드 외에도 문서는 노드의 부모 ID를 저장한다.</p>
<p>위 이미지 형태의 구조를 아래와 같이 저장한다고 볼 수 있다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">db.<span class="property">categories</span>.<span class="title function_">insertMany</span>( [</span><br><span class="line">   &#123; <span class="attr">_id</span>: <span class="string">&quot;MongoDB&quot;</span>, <span class="attr">parent</span>: <span class="string">&quot;Databases&quot;</span> &#125;,</span><br><span class="line">   &#123; <span class="attr">_id</span>: <span class="string">&quot;dbm&quot;</span>, <span class="attr">parent</span>: <span class="string">&quot;Databases&quot;</span> &#125;,</span><br><span class="line">   &#123; <span class="attr">_id</span>: <span class="string">&quot;Databases&quot;</span>, <span class="attr">parent</span>: <span class="string">&quot;Programming&quot;</span> &#125;,</span><br><span class="line">   &#123; <span class="attr">_id</span>: <span class="string">&quot;Languages&quot;</span>, <span class="attr">parent</span>: <span class="string">&quot;Programming&quot;</span> &#125;,</span><br><span class="line">   &#123; <span class="attr">_id</span>: <span class="string">&quot;Programming&quot;</span>, <span class="attr">parent</span>: <span class="string">&quot;Books&quot;</span> &#125;,</span><br><span class="line">   &#123; <span class="attr">_id</span>: <span class="string">&quot;Books&quot;</span>, <span class="attr">parent</span>: <span class="literal">null</span> &#125;</span><br><span class="line">] )</span><br></pre></td></tr></table></figure>
<p>노드의 부모를 검색할 때는 다음과 같이 검색할 수 있다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.<span class="property">categories</span>.<span class="title function_">findOne</span>( &#123; <span class="attr">_id</span>: <span class="string">&quot;MongoDB&quot;</span> &#125; ).<span class="property">parent</span></span><br></pre></td></tr></table></figure>

<p>부모 필드를 통해 children을 검색할 수 있다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.<span class="property">categories</span>.<span class="title function_">find</span>( &#123; <span class="attr">parent</span>: <span class="string">&quot;Databases&quot;</span> &#125; )</span><br></pre></td></tr></table></figure>

<h3 id="Child-References"><a href="#Child-References" class="headerlink" title="Child References"></a>Child References</h3><p><em>Child References</em> 패턴은 각 트리 노드를 하나의 다큐멘트에 저장한다. 트리 노드 데이터에 자식 노드들의 id 배열을 저장한다.</p>
<p>즉 아래와 같이 위 이미지 형태의 트리 구조를 저장한다는 뜻이다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">db.<span class="property">categories</span>.<span class="title function_">insertMany</span>( [</span><br><span class="line">   &#123; <span class="attr">_id</span>: <span class="string">&quot;MongoDB&quot;</span>, <span class="attr">children</span>: [] &#125;,</span><br><span class="line">   &#123; <span class="attr">_id</span>: <span class="string">&quot;dbm&quot;</span>, <span class="attr">children</span>: [] &#125;,</span><br><span class="line">   &#123; <span class="attr">_id</span>: <span class="string">&quot;Databases&quot;</span>, <span class="attr">children</span>: [ <span class="string">&quot;MongoDB&quot;</span>, <span class="string">&quot;dbm&quot;</span> ] &#125;,</span><br><span class="line">   &#123; <span class="attr">_id</span>: <span class="string">&quot;Languages&quot;</span>, <span class="attr">children</span>: [] &#125;,</span><br><span class="line">   &#123; <span class="attr">_id</span>: <span class="string">&quot;Programming&quot;</span>, <span class="attr">children</span>: [ <span class="string">&quot;Databases&quot;</span>, <span class="string">&quot;Languages&quot;</span> ] &#125;,</span><br><span class="line">   &#123; <span class="attr">_id</span>: <span class="string">&quot;Books&quot;</span>, <span class="attr">children</span>: [ <span class="string">&quot;Programming&quot;</span> ] &#125;</span><br><span class="line">] )</span><br></pre></td></tr></table></figure>
<p>자식 노드들을 찾을 때는 아래와 같이 쿼리를 하게 된다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.<span class="property">categories</span>.<span class="title function_">findOne</span>( &#123; <span class="attr">_id</span>: <span class="string">&quot;Databases&quot;</span> &#125; ).<span class="property">children</span></span><br></pre></td></tr></table></figure>

<p>특정 자식 노드 값을 가지고 있는 부모 값을 찾기 위해서는 다음과 같은 쿼리를 사용한다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.<span class="property">categories</span>.<span class="title function_">find</span>( &#123; <span class="attr">children</span>: <span class="string">&quot;MongoDB&quot;</span> &#125; )</span><br></pre></td></tr></table></figure>

<p><em>Children References</em> 패턴은 하위 트리에 대한 작업이 필요하지 않다면 적합한 방법이다. 이 패턴은 노드가 여러 개의 부모를 가질 수 잇는 경우에도 적합한 방법이 될 수 있다.</p>
<h3 id="Array-of-Ancestors"><a href="#Array-of-Ancestors" class="headerlink" title="Array of Ancestors"></a>Array of Ancestors</h3><p><em>Array of Ancestors</em> 패턴은 각 트리 노드를 하나의 다큐멘트에 담는 방법이다. 트리 노드 데이터에, 노드의 조상들 또는 경로의 id 배열을 저장하는 방법이다.</p>
<p>위 이미지 형태를 아래와 같이 저장하는 방법이다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">db.<span class="property">categories</span>.<span class="title function_">insertMany</span>( [</span><br><span class="line">  &#123; <span class="attr">_id</span>: <span class="string">&quot;MongoDB&quot;</span>, <span class="attr">ancestors</span>: [ <span class="string">&quot;Books&quot;</span>, <span class="string">&quot;Programming&quot;</span>, <span class="string">&quot;Databases&quot;</span> ], <span class="attr">parent</span>: <span class="string">&quot;Databases&quot;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">_id</span>: <span class="string">&quot;dbm&quot;</span>, <span class="attr">ancestors</span>: [ <span class="string">&quot;Books&quot;</span>, <span class="string">&quot;Programming&quot;</span>, <span class="string">&quot;Databases&quot;</span> ], <span class="attr">parent</span>: <span class="string">&quot;Databases&quot;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">_id</span>: <span class="string">&quot;Databases&quot;</span>, <span class="attr">ancestors</span>: [ <span class="string">&quot;Books&quot;</span>, <span class="string">&quot;Programming&quot;</span> ], <span class="attr">parent</span>: <span class="string">&quot;Programming&quot;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">_id</span>: <span class="string">&quot;Languages&quot;</span>, <span class="attr">ancestors</span>: [ <span class="string">&quot;Books&quot;</span>, <span class="string">&quot;Programming&quot;</span> ], <span class="attr">parent</span>: <span class="string">&quot;Programming&quot;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">_id</span>: <span class="string">&quot;Programming&quot;</span>, <span class="attr">ancestors</span>: [ <span class="string">&quot;Books&quot;</span> ], <span class="attr">parent</span>: <span class="string">&quot;Books&quot;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">_id</span>: <span class="string">&quot;Books&quot;</span>, <span class="attr">ancestors</span>: [ ], <span class="attr">parent</span>: <span class="literal">null</span> &#125;</span><br><span class="line">] )</span><br></pre></td></tr></table></figure>

<p>조상들 또는 경로를 찾기 위해 다음과 같이 쿼리를 사용할 수 있다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.<span class="property">categories</span>.<span class="title function_">findOne</span>( &#123; <span class="attr">_id</span>: <span class="string">&quot;MongoDB&quot;</span> &#125; ).<span class="property">ancestors</span></span><br></pre></td></tr></table></figure>
<p>자손들을 모두 찾기 위해서 다음과 같이 쿼리를 사용할 수 있다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.<span class="property">categories</span>.<span class="title function_">find</span>( &#123; <span class="attr">ancestors</span>: <span class="string">&quot;Programming&quot;</span> &#125; )</span><br></pre></td></tr></table></figure>

<p><em>Array of Ancestors</em> 패턴은 빠르고 효율적으로 자손과 조상들을 찾을 수 있게 해준다.</p>
<p><em>Array of Ancestors</em> 패턴은 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://docs.mongodb.com/manual/tutorial/model-tree-structures-with-materialized-paths/">Materialized Paths</a> 패턴보다는 약간 느리지만, 좀 더 직관적으로 사용할 수 있다.</p>
<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://docs.mongodb.com/manual/core/data-modeling-introduction/">https://docs.mongodb.com/manual/core/data-modeling-introduction/</a></li>
</ul>
</div><div class="article-licensing box"><div class="licensing-title"><p>MongoDB 모델링</p><p><a href="https://changhoi.kim/posts/database/mongodb-modeling/">https://changhoi.kim/posts/database/mongodb-modeling/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>changhoi</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2021-05-08</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2021-05-08</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="external nofollow noopener noreferrer" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="external nofollow noopener noreferrer" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="external nofollow noopener noreferrer" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/architecture/">architecture</a><a class="link-muted mr-2" rel="tag" href="/tags/mongodb/">mongodb</a></div><div class="a2a_kit a2a_kit_size_32 a2a_default_style"><a class="a2a_dd" target="_blank" rel="external nofollow noopener noreferrer" href="https://www.addtoany.com/share"></a><a class="a2a_button_facebook"></a><a class="a2a_button_twitter"></a><a class="a2a_button_telegram"></a><a class="a2a_button_whatsapp"></a><a class="a2a_button_reddit"></a></div><script src="https://static.addtoany.com/menu/page.js" defer></script></article></div><div class="card"><div class="card-content"><h3 class="title is-5">관련 글</h3><article class="media"><figure class="media-left"><a class="image" href="/posts/go/go-pkg-architecture-theory/"><img src="/images/2023-07-13-go-pkg-architecture/thumbnail.png" alt="Go Package Architecture - 이론편"></a></figure><div class="media-content"><p class="date"><time datetime="2023-07-12T15:00:00.000Z">2023-07-13</time></p><p class="title"><a href="/posts/go/go-pkg-architecture-theory/">Go Package Architecture - 이론편</a></p><p class="categories"><a href="/categories/go/">go</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/posts/database/scaling-memcache-at-facebook/"><img src="/images/2023-06-23-scaling-memcache-at-facebook/thumbnail.png?style=centerme" alt="Scaling Memcache At Facebook"></a></figure><div class="media-content"><p class="date"><time datetime="2023-06-22T15:00:00.000Z">2023-06-23</time></p><p class="title"><a href="/posts/database/scaling-memcache-at-facebook/">Scaling Memcache At Facebook</a></p><p class="categories"><a href="/categories/database/">database</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/posts/database/etcd-client-model/"><img src="/images/2022-11-03-etcd-data-model/thumbnail.png" alt="etcd deep dive - Client Model"></a></figure><div class="media-content"><p class="date"><time datetime="2022-12-10T15:00:00.000Z">2022-12-11</time></p><p class="title"><a href="/posts/database/etcd-client-model/">etcd deep dive - Client Model</a></p><p class="categories"><a href="/categories/database/">database</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/posts/database/etcd-data-model/"><img src="/images/2022-11-03-etcd-data-model/thumbnail.png" alt="etcd deep dive - Data Model"></a></figure><div class="media-content"><p class="date"><time datetime="2022-11-02T15:00:00.000Z">2022-11-03</time></p><p class="title"><a href="/posts/database/etcd-data-model/">etcd deep dive - Data Model</a></p><p class="categories"><a href="/categories/database/">database</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/posts/database/dynamodb-internals-2/"><img src="/images/2022-04-16-dynamodb-internals-1/thumbnail.png" alt="DynamoDB Internals (2) - DynamoDB"></a></figure><div class="media-content"><p class="date"><time datetime="2022-04-18T15:00:00.000Z">2022-04-19</time></p><p class="title"><a href="/posts/database/dynamodb-internals-2/">DynamoDB Internals (2) - DynamoDB</a></p><p class="categories"><a href="/categories/database/">database</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/posts/database/dynamodb-internals-1/"><img src="/images/2022-04-16-dynamodb-internals-1/thumbnail.png" alt="DynamoDB Internals (1) - Dynamo"></a></figure><div class="media-content"><p class="date"><time datetime="2022-04-15T15:00:00.000Z">2022-04-16</time></p><p class="title"><a href="/posts/database/dynamodb-internals-1/">DynamoDB Internals (1) - Dynamo</a></p><p class="categories"><a href="/categories/database/">database</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/posts/database/rdb-scaling/"><img src="/images/2022-02-09-rdb-scaling/thumbnail.png?style=centerme" alt="RDB 스케일링"></a></figure><div class="media-content"><p class="date"><time datetime="2022-02-08T15:00:00.000Z">2022-02-09</time></p><p class="title"><a href="/posts/database/rdb-scaling/">RDB 스케일링</a></p><p class="categories"><a href="/categories/database/">database</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/posts/database/dynamodb-single-table-design/"><img src="/images/2022-04-16-dynamodb-internals-1/thumbnail.png" alt="DynamoDB 설계 방법: Single Table Design"></a></figure><div class="media-content"><p class="date"><time datetime="2020-10-23T15:00:00.000Z">2020-10-24</time></p><p class="title"><a href="/posts/database/dynamodb-single-table-design/">DynamoDB 설계 방법: Single Table Design</a></p><p class="categories"><a href="/categories/database/">database</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/posts/backend/serverside-typescript-setting-01/"><img src="https://devblogs.microsoft.com/typescript/wp-content/uploads/sites/11/2018/08/typescriptfeature.png" alt="Monolithic 서버사이드 타입스크립트 세팅 01"></a></figure><div class="media-content"><p class="date"><time datetime="2020-03-10T15:00:00.000Z">2020-03-11</time></p><p class="title"><a href="/posts/backend/serverside-typescript-setting-01/">Monolithic 서버사이드 타입스크립트 세팅 01</a></p><p class="categories"><a href="/categories/backend/">backend</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/posts/serverless/serverless-architecture-pattern/"><img src="https://miro.medium.com/max/730/1*Fjsk_yELuDAavR8sXOW6Sg.png" alt="서버리스 아키텍처 패턴"></a></figure><div class="media-content"><p class="date"><time datetime="2019-12-08T15:00:00.000Z">2019-12-09</time></p><p class="title"><a href="/posts/serverless/serverless-architecture-pattern/">서버리스 아키텍처 패턴</a></p><p class="categories"><a href="/categories/serverless/">serverless</a></p></div></article></div></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/posts/etc/red-black-tree/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Red-Black Tree</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/posts/logs/20210501/"><span class="level-item">4개월 간 서비스 개발 후기 (사업화 실패하는 데 성공)</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card" id="comments"><div class="card-content"><h3 class="title is-5">댓글</h3><div class="fb-comments" data-width="100%" data-href="https://changhoi.kim/posts/database/mongodb-modeling/" data-num-posts="5"></div><script>(function(d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) return;
            js = d.createElement(s); js.id = id;
            js.src = "//connect.facebook.net/ko/sdk.js#xfbml=1&version=v12.0";
            fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="https://avatars2.githubusercontent.com/u/34329147?s=400&amp;u=9d1b1dc88bc8ee5965f35b0160780264c3619eb6&amp;v=4" alt="Changhoi Kim"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Changhoi Kim</p><p class="is-size-6 is-block">Co-Founder of Bayesians</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Seoul, Korea</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">포스트</p><a href="/archives/"><p class="title">73</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">카테고리</p><a href="/categories/"><p class="title">13</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">태그</p><a href="/tags/"><p class="title">47</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://www.linkedin.com/in/changhoi/" target="_blank" rel="external nofollow noopener noreferrer">팔로우</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="external nofollow noopener noreferrer" title="LinkedIn" href="https://www.linkedin.com/in/changhoi/"><i class="fab fa-linkedin"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="external nofollow noopener noreferrer" title="Github" href="https://github.com/changhoi"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="external nofollow noopener noreferrer" title="Email" href="mailto:changhoi0522@gmail.com"><i class="fas fa-envelope-square"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="external nofollow noopener noreferrer" title="English" href="https://jayce.kim"><i class="fas fa-language"></i></a></div></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">카테고리</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/backend/"><span class="level-start"><span class="level-item">backend</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile" href="/categories/books/"><span class="level-start"><span class="level-item">books</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/database/"><span class="level-start"><span class="level-item">database</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile" href="/categories/docker/"><span class="level-start"><span class="level-item">docker</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/essay/"><span class="level-start"><span class="level-item">essay</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/etc/"><span class="level-start"><span class="level-item">etc</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile" href="/categories/go/"><span class="level-start"><span class="level-item">go</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/linux/"><span class="level-start"><span class="level-item">linux</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/logs/"><span class="level-start"><span class="level-item">logs</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/categories/network/"><span class="level-start"><span class="level-item">network</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/os/"><span class="level-start"><span class="level-item">os</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/rust/"><span class="level-start"><span class="level-item">rust</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/serverless/"><span class="level-start"><span class="level-item">serverless</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li></ul></div></div></div><div class="column-right-shadow is-hidden-widescreen is-sticky"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3 is-sticky"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">카탈로그</h3><ul class="menu-list"><li><a class="level is-mobile" href="#Flexible-Schema"><span class="level-left"><span class="level-item">1</span><span class="level-item">Flexible Schema</span></span></a></li><li><a class="level is-mobile" href="#Document-Structure"><span class="level-left"><span class="level-item">2</span><span class="level-item">Document Structure</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Embedded-Data"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">Embedded Data</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#엔티티-사이에-포함-관계가-있는-경우-1-1-관계"><span class="level-left"><span class="level-item">2.1.1</span><span class="level-item">엔티티 사이에 포함 관계가 있는 경우 (1:1 관계)</span></span></a></li><li><a class="level is-mobile" href="#엔티티-사이에-1-N-관계가-있고-N이-1-부분에-항상-보여야-할-때"><span class="level-left"><span class="level-item">2.1.2</span><span class="level-item">엔티티 사이에 1:N 관계가 있고, N이 1 부분에 항상 보여야 할 때</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="#Normalized-Data-Model-Reference"><span class="level-left"><span class="level-item">3</span><span class="level-item">Normalized Data Model (Reference)</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#1-N-관계"><span class="level-left"><span class="level-item">3.1</span><span class="level-item">1:N 관계</span></span></a></li><li><a class="level is-mobile" href="#트리-구조"><span class="level-left"><span class="level-item">3.2</span><span class="level-item">트리 구조</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Parent-References"><span class="level-left"><span class="level-item">3.2.1</span><span class="level-item">Parent References</span></span></a></li><li><a class="level is-mobile" href="#Child-References"><span class="level-left"><span class="level-item">3.2.2</span><span class="level-item">Child References</span></span></a></li><li><a class="level is-mobile" href="#Array-of-Ancestors"><span class="level-left"><span class="level-item">3.2.3</span><span class="level-item">Array of Ancestors</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="#Reference"><span class="level-left"><span class="level-item">4</span><span class="level-item">Reference</span></span></a></li></ul></div></div><script src="/js/toc.js" defer></script></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.jpg" alt="Changhoi Kim" height="28"></a><p class="is-size-7"><span>&copy; 2025 changhoi</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="external nofollow noopener noreferrer">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="external nofollow noopener noreferrer">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="external nofollow noopener noreferrer" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="external nofollow noopener noreferrer" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("ko");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script data-pjax src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="맨 위로" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script data-pjax src="/js/back_to_top.js" defer></script><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><div id="outdated"><h6>Your browser is out-of-date!</h6><p>Update your browser to view this website correctly.&amp;npsb;<a id="btnUpdateBrowser" target="_blank" rel="external nofollow noopener noreferrer" href="http://outdatedbrowser.com/">Update my browser now </a></p><p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">×</a></p></div><script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script><script>window.addEventListener("load", function () {
            outdatedBrowser({
                bgColor: '#f25648',
                color: '#ffffff',
                lowerThan: 'object-fit' // display on IE11 or below
            });
        });</script><!--!--><script data-pjax src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="입력 하세요..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script data-pjax src="/js/insight.js" defer></script><script data-pjax>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"입력 하세요...","untitled":"(제목 없음)","posts":"포스트","pages":"페이지","categories":"카테고리","tags":"태그"});
        });</script></body></html>